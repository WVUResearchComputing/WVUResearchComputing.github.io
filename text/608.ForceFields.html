

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Force Field Molecular Dynamics &mdash; WVU-RC 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CHARM++ and NAMD" href="609.CHARM++_NAMD.html" />
    <link rel="prev" title="Fast Fourier Transforms" href="607.FFT.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WVU-RC
          

          
            
            <img src="../_static/ResearchComputing.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="10.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="20.QuickStart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="30.BasicUser.html">For Basic Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="40.AdvancedUser.html">For Advanced Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="50.ProgrammingLanguages.html">Programming Languages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="600.SoftAdmin.html">Software Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="601.SphinxDocs.html">Editing these documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="602.UserInstallation.html">Installing Packages in User Locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="603.LinearAlgebra.html">Linear Algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="604.Boost.html">Boost 1.77</a></li>
<li class="toctree-l2"><a class="reference internal" href="605.MPI.html">Message Passing Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="606.HDF5_NetCDF.html">HDF5 and NetCDF</a></li>
<li class="toctree-l2"><a class="reference internal" href="607.FFT.html">Fast Fourier Transforms</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Force Field Molecular Dynamics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#plumed">Plumed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#amber">AMBER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gcc-9-3-serial">GCC 9.3 (Serial)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcc-9-3-openmp">GCC 9.3 (OpenMP)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcc-9-3-mpich-3-4-1">GCC 9.3 (MPICH 3.4.1)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcc-9-3-cuda">GCC 9.3 (CUDA)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcc-9-3-openmp-mpi-cuda">GCC 9.3 (OpenMP + MPI + CUDA)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcc-11-1-serial">GCC 11.1 (Serial)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcc-11-1-openmp">GCC 11.1 (OpenMP)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcc-11-1-openmpi-4-1-1">GCC 11.1 (OpenMPI 4.1.1)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intel-compilers-2021-serial">Intel Compilers 2021 (Serial)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intel-compilers-2021-openmp">Intel Compilers 2021 (OpenMP)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intel-compilers-2021-intel-mpi-2021">Intel Compilers 2021 (Intel MPI 2021)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intel-compilers-2021-cuda">Intel Compilers 2021 (CUDA)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-tests">Running Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gromacs">Gromacs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gromacs-2021-2-on-thorny-flat">Gromacs 2021.2 on Thorny Flat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gromacs-5-1-5-on-thorny-flat">Gromacs 5.1.5 on Thorny Flat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gromacs-2019-4-on-spruce-knob">Gromacs 2019.4 on Spruce Knob</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lammps">LAMMPS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="609.CHARM++_NAMD.html">CHARM++ and NAMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="610.DFT.html">Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="611.BigData.html">Big Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="612.Python.html">Python 3.9.7</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="70.DomainSpecific.html">Domain Specific Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="80.ClusterSpecific.html">Clusters Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="90.References.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WVU-RC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="600.SoftAdmin.html">Software Administration</a> &raquo;</li>
        
      <li>Force Field Molecular Dynamics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/text/608.ForceFields.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="force-field-molecular-dynamics">
<h1>Force Field Molecular Dynamics<a class="headerlink" href="#force-field-molecular-dynamics" title="Permalink to this headline">¶</a></h1>
<p>These are instructions for compiling a variety of atomistic codes. By atomistic codes, we include codes that simulate the behavior of particles such as LAMMPS, codes for Classical Molecular Dynamics (CMD) such as AMBER, GROMACS, and NAMD,
Tight Binding codes such as DFTB+ and DFT codes such as ABINIT, OCTOPUS, VASP, and Quantum Espresso.</p>
<p>For compiling these codes we need Fortran, C, and C++ compilers, we will use GCC 9.3 and Intel 2019 for most of these codes.</p>
<p>A set of numerical libraries are used very often by these codes. Dense Linear Algebra routines such as BLAS and LAPACK are used. Optimized versions such as OpenBLAS and Intel MKL are preferable over the reference versions from NetLIB.</p>
<p>All atomistic codes in our list take advantage of parallelization, either OpenMP, MPI, or support GPUs. OpenMP is implemented on modern compilers such as GCC, Intel, and NVIDIA. For MPI we will use MPICH 3.4.1, OpenMPI 3.1.6, and Intel MPI from 2019.</p>
<p>Other libraries needed for compiling these codes include an FFT library such as FFTW 3.3.9 or the implementation in MKL. The libraries need to be compiled for single and double precision as some codes use both. An HDF5 and NetCDF libraries
provide hierarchical data storage for numerical data. Finally, a Python implementation is often needed, because these codes include a Python interface or use it for building or testing.</p>
<p>We will start with PLUMED, a library for sampling algorithms, free-energy calculations, and other high-level calculations on top of MD packages. W</p>
<div class="section" id="plumed">
<h2>Plumed<a class="headerlink" href="#plumed" title="Permalink to this headline">¶</a></h2>
<p>PLUMED is an open-source library that provides a wide range of different methods that work on top of other Molecular Dynamics codes. Capabilities of the code include:</p>
<blockquote>
<div><ul class="simple">
<li>Enhanced-sampling algorithms</li>
<li>Free-energy methods</li>
<li>Tools to analyze the vast amounts of data produced by molecular dynamics (MD) simulations.</li>
</ul>
</div></blockquote>
<p>We compile PLUMED with the following modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span> <span class="n">parallel</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93</span> \
<span class="n">lang</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cpython_3</span><span class="o">.</span><span class="mf">9.5</span><span class="n">_gcc93</span> <span class="n">libs</span><span class="o">/</span><span class="n">openblas</span><span class="o">/</span><span class="mf">0.3</span><span class="o">.</span><span class="mi">13</span><span class="n">_gcc93</span> \
<span class="n">libs</span><span class="o">/</span><span class="n">fftw</span><span class="o">/</span><span class="mf">3.3</span><span class="o">.</span><span class="mi">9</span><span class="n">_gcc93</span>
</pre></div>
</div>
<p>Download PLUMED from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">plumed</span><span class="o">/</span><span class="n">plumed2</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v2</span><span class="o">.</span><span class="mf">7.1</span><span class="o">/</span><span class="n">plumed</span><span class="o">-</span><span class="mf">2.7</span><span class="o">.</span><span class="mf">1.</span><span class="n">tgz</span>
</pre></div>
</div>
<p>Uncompress and configure the build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tar -zxvf plumed-2.7.1.tgz
cd plumed-2.7.1
./configure --prefix=/shared/software/atomistic/plumed/2.7.1_gcc93_mpic341 PYTHON_BIN=python3 --enable-external-blas --enable-external-lapack LDFLAGS=-L${MD_OPENBLAS}/lib LIBS=-lopenblas
</pre></div>
</div>
<p>After configuring the build. Execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">12</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>PLUMED includes a test suite and it is always a good practice to test the compilation. Call make to run the test suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">check</span>
</pre></div>
</div>
<p>The final lines of the tests show no failures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>...
+ check file ves/rt-td-vonmises/report.txt for more information
+ test ves/rt-VesDeltaF/ NOT APPLICABLE
+ check file ves/rt-VesDeltaF/report.txt for more information
+ test ves/rt-VesDeltaF-mwalkers/ NOT APPLICABLE
+ check file ves/rt-VesDeltaF-mwalkers/report.txt for more information
+++++++++++++++++++++++++++++++++++++++++++++++++++++
+ Final report:
+ 298 tests performed, 223 tests not applicable
+ 0 errors found
+ Well done!!
+++++++++++++++++++++++++++++++++++++++++++++++++++++

make[1]: Leaving directory &#39;/gpfs20/shared/src/plumed-2.7.1/regtest&#39;
</pre></div>
</div>
<p>After installation, PLUMED offers a very convenient prepared module file.
The file can be copied along with the rest of modulefiles with a simple edit for loading the modules used during compilation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">plumed</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93_mpic341</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">plumed</span><span class="o">/</span><span class="n">modulefile</span> <span class="o">/</span><span class="n">shared</span><span class="o">/</span><span class="n">modulefiles</span><span class="o">/</span><span class="n">tier2</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">plumed</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93_mpic341</span>
</pre></div>
</div>
<p>The only change needed for this modulefile is adding one line loading the other modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#%Module1.0##############################################</span>

<span class="c1"># Manually add here dependencies and conflicts</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span> <span class="n">parallel</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93</span> <span class="n">lang</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cpython_3</span><span class="o">.</span><span class="mf">9.5</span><span class="n">_gcc93</span> <span class="n">libs</span><span class="o">/</span><span class="n">openblas</span><span class="o">/</span><span class="mf">0.3</span><span class="o">.</span><span class="mi">13</span><span class="n">_gcc93</span> <span class="n">libs</span><span class="o">/</span><span class="n">fftw</span><span class="o">/</span><span class="mf">3.3</span><span class="o">.</span><span class="mi">9</span><span class="n">_gcc93</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="amber">
<h2>AMBER<a class="headerlink" href="#amber" title="Permalink to this headline">¶</a></h2>
<p>Amber is a suite of biomolecular simulation programs.
It is used to simulate large and complex atomic compounds using a set of molecular mechanical force fields for the simulation of biomolecules.</p>
<p>In this document, we provide instructions to compile Amber using GCC 9.3, 11.1, and Intel Compilers 2021
Amber can be compiled with a variety of options for parallelization.
Amber can be compiled as pure serial code,  using multithreading with OpenMP, distributed parallelism with MPI, and using GPUs with CUDA.
We will be building Amber with each option and one final compilation enabling OpenMP, MPI, and CUDA.</p>
<p>Amber as a package is composed of two pieces, Amber itself and AmberTools.
Amber facilitates faster simulations (on parallel CPU or GPU hardware) and is distributed with a paid license.
AmberTools is a free package that collect open-source code to be used in conjunction with Amber.
The version used to produce these notes is Amber 20, the latest version available by mid-2021.</p>
<p>We start with two files, <code class="docutils literal notranslate"><span class="pre">Amber20.tar.bz2</span></code> and <code class="docutils literal notranslate"><span class="pre">AmberTools20.tar.bz2</span></code>.
The first step is to uncompress both of them.
The two compressed tars will uncompress on the same target folder <code class="docutils literal notranslate"><span class="pre">amber20_src</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">jxvf</span> <span class="n">Amber20</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">jxvf</span> <span class="n">AmberTools20</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
<span class="n">cd</span> <span class="n">amber20_src</span>
</pre></div>
</div>
<p>We start with GCC 9.3 where most of the tools can be enabled and the compilation is easier.
We start with a pure Serial build, we move after to enable OpenMP, after that, we disable OpenMP and enable MPI.
We move the building process to a GPU node to compile a CUDA version disabling OpenMP and MPI and we finalize enabling all options for a final build.
The reason for doing this is that keeping just one parallelization active will facilitate the usage for casual users, instead of dealing with complex combinations of threads, MPI processes, and GPU cards.</p>
<div class="section" id="gcc-9-3-serial">
<h3>GCC 9.3 (Serial)<a class="headerlink" href="#gcc-9-3-serial" title="Permalink to this headline">¶</a></h3>
<p>Decompressing <code class="docutils literal notranslate"><span class="pre">Amber20.tar.bz2</span></code> and <code class="docutils literal notranslate"><span class="pre">AmberTools20.tar.bz2</span></code> will create a folder <code class="docutils literal notranslate"><span class="pre">amber20_src</span></code>.
There is one file <code class="docutils literal notranslate"><span class="pre">amber20_src/build/run_cmake.sample</span></code> that we will use as a template changing it for each build from now on.
It is always convenient to build the code on a folder separated from the sources.
Create a folder for each build, for the serial case, we suggest:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">amber20_src</span>
<span class="n">mkdir</span> <span class="n">build_gcc93_mpic341</span>
</pre></div>
</div>
<p>The reason for the name is that in this folder we will compile all builds, including the MPI version using MPICH 3.4.1
Inside this folder copy the file <code class="docutils literal notranslate"><span class="pre">amber20_src/build/run_cmake.sample</span></code>
The orginal content of this file is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

#  This file gives some sample cmake invocations.  You may wish to
#  edit some options that are chosen here.

#  For information on how to get cmake, visit this page:
#  https://ambermd.org/pmwiki/pmwiki.php/Main/CMake-Quick-Start

#  For information on common options for cmake, visit this page:
#  http://ambermd.org/pmwiki/pmwiki.php/Main/CMake-Common-Options

#  (Note that you can change the value of CMAKE_INSTALL_PREFIX from what
#  is suggested below, but it cannot coincide with the amber20_src
#  folder.)

AMBER_PREFIX=$(dirname $(dirname `pwd`))

if [ `uname -s|awk &#39;{print $1}&#39;` = &quot;Darwin&quot; ]; then

#  For macOS:

  if [ -x /Applications/CMake.app/Contents/bin/cmake ]; then
         cmake=/Applications/CMake.app/Contents/bin/cmake
  else
         cmake=cmake
  fi

  $cmake $AMBER_PREFIX/amber20_src \
        -DCMAKE_INSTALL_PREFIX=$AMBER_PREFIX/amber20 \
        -DCOMPILER=CLANG  -DBLA_VENDOR=Apple \
        -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
        -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
        2&gt;&amp;1 | tee cmake.log

else

#  Assume this is Linux:

  cmake $AMBER_PREFIX/amber20_src \
        -DCMAKE_INSTALL_PREFIX=$AMBER_PREFIX/amber20 \
        -DCOMPILER=GNU  \
        -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
        -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
        2&gt;&amp;1 | tee  cmake.log

fi

if [ ! -s cmake.log ]; then
  echo &quot;&quot;
  echo &quot;Error:  No cmake.log file created: you may need to edit run_cmake&quot;
  exit 1
fi

echo &quot;&quot;
echo &quot;If the cmake build report looks OK, you should now do the following:&quot;
echo &quot;&quot;
echo &quot;    make install&quot;
echo &quot;    source $AMBER_PREFIX/amber20/amber.sh&quot;
echo &quot;&quot;
echo &quot;Consider adding the last line to your login startup script, e.g. ~/.bashrc&quot;
echo &quot;&quot;
</pre></div>
</div>
<p>We will only make modifications to this file in two locations.
We add an extra variable for defining the PREFIX:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc93_serial
</pre></div>
</div>
<p>This is the PREFIX that we will use for the Serial compilation
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/9.3.0/lib/libbz2.a \
  -DOPENMP=FALSE -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>The lines above are for a purely serial build of Amber.</p>
<p>Now we need to load some modules for compiling the code.
Amber uses CMAKE as a software builder.
The version included with RedHat 7.x (2.18) is too old for most scientific codes.
We will load modules for cmake 3.21.1 and GCC 9.3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.21</span><span class="o">.</span><span class="mi">1</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span> <span class="n">lang</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cpython_3</span><span class="o">.</span><span class="mf">9.5</span><span class="n">_gcc93</span>
</pre></div>
</div>
<p>There is a bug in the script for Miniconda, that will prevent cmake of building a complete environment.
On the line 153 of <code class="docutils literal notranslate"><span class="pre">amber20_src/cmake/UseMiniconda.cmake</span></code> add a line to install pip via conda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>execute_process(COMMAND ${CONDA} update conda -y)
execute_process(COMMAND ${CONDA} install pip -y)
execute_process(COMMAND ${MINICONDA_PYTHON} -m pip install pip --upgrade)
</pre></div>
</div>
<p>If you do skip this step, conda will remove pip after the update and several other python packages that are installed with pip will fail.
This is the only change in the sources.
No other changes will be done directly to sources, if something fails, we simply disable the corresponding package.
Run the <code class="docutils literal notranslate"><span class="pre">run_cmake</span></code> inside the corresponding build folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build_gcc93_mpic341</span>
<span class="o">./</span><span class="n">run_cmake</span>
</pre></div>
</div>
<p>When running the script, Miniconda will be downloaded and installed, this is the portion of the execution that requires internet access and cannot be executed from a GPU node.
We will preserve this folder for all other builds, in particular those for CUDA that are executed inside GPU nodes with no internet accesss.</p>
<p>After CMAKE have prepared the folder for compilation, execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>The code will compile in a few minutes. To install the build execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="gcc-9-3-openmp">
<h3>GCC 9.3 (OpenMP)<a class="headerlink" href="#gcc-9-3-openmp" title="Permalink to this headline">¶</a></h3>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc93_openmp
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/9.3.0/lib/libbz2.a \
  -DOPENMP=TRUE -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>The running of <code class="docutils literal notranslate"><span class="pre">make</span></code> followed by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> is not necessary, the later will run make and build the binaries before installing them.</p>
</div>
<div class="section" id="gcc-9-3-mpich-3-4-1">
<h3>GCC 9.3 (MPICH 3.4.1)<a class="headerlink" href="#gcc-9-3-mpich-3-4-1" title="Permalink to this headline">¶</a></h3>
<p>We will add a new module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">parallel</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93</span>
</pre></div>
</div>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc93_mpic341
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/9.3.0/lib/libbz2.a \
  -DOPENMP=FALSE -DMPI=TRUE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="gcc-9-3-cuda">
<h3>GCC 9.3 (CUDA)<a class="headerlink" href="#gcc-9-3-cuda" title="Permalink to this headline">¶</a></h3>
<p>This build is done on a GPU node, request an interactive execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="o">-</span><span class="n">I</span> <span class="o">-</span><span class="n">l</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ppn</span><span class="o">=</span><span class="mi">8</span><span class="p">:</span><span class="n">gpus</span><span class="o">=</span><span class="mi">3</span> <span class="o">-</span><span class="n">q</span> <span class="n">comm_gpu_inter</span>
</pre></div>
</div>
<p>Load all the modules used in the previous builds adding the module for CUDA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.21</span><span class="o">.</span><span class="mi">1</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span> <span class="n">lang</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cpython_3</span><span class="o">.</span><span class="mf">9.5</span><span class="n">_gcc93</span> <span class="n">parallel</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93</span> <span class="n">parallel</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="mf">11.3</span>
</pre></div>
</div>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc93_cuda113
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/9.3.0/lib/libbz2.a \
  -DOPENMP=FALSE -DMPI=FALSE -DCUDA=TRUE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="gcc-9-3-openmp-mpi-cuda">
<h3>GCC 9.3 (OpenMP + MPI + CUDA)<a class="headerlink" href="#gcc-9-3-openmp-mpi-cuda" title="Permalink to this headline">¶</a></h3>
<p>This build is done on a GPU node, reuse the previous interactive session or request a new one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="o">-</span><span class="n">I</span> <span class="o">-</span><span class="n">l</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ppn</span><span class="o">=</span><span class="mi">8</span><span class="p">:</span><span class="n">gpus</span><span class="o">=</span><span class="mi">3</span> <span class="o">-</span><span class="n">q</span> <span class="n">comm_gpu_inter</span>
</pre></div>
</div>
<p>Load all the modules used in the previous builds adding the module for CUDA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.21</span><span class="o">.</span><span class="mi">1</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span> <span class="n">lang</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cpython_3</span><span class="o">.</span><span class="mf">9.5</span><span class="n">_gcc93</span> <span class="n">parallel</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93</span> <span class="n">parallel</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="mf">11.3</span>
</pre></div>
</div>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc93_mpic341_cuda113
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/9.3.0/lib/libbz2.a \
  -DOPENMP=TRUE -DMPI=TRUE -DCUDA=TRUE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>Once AMBER is compiled and the modulefile created, use a GPU node to run the testsuite. There are two versions of it running AMBER the CUDA tests are either serial or parallel. Here are the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==&gt;</span> <span class="o">/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">amber</span><span class="o">/</span><span class="mi">20</span><span class="n">_gcc93_mpic341_cuda</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">test_amber_cuda</span><span class="o">/</span><span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26_11</span><span class="o">-</span><span class="mi">31</span><span class="o">-</span><span class="mf">03.</span><span class="n">log</span> <span class="o">&lt;==</span>
<span class="n">diffing</span> <span class="n">md_SC_NVT_MBAR_SC_2</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">DPFP</span> <span class="k">with</span> <span class="n">md_SC_NVT_MBAR_SC_2</span><span class="o">.</span><span class="n">o</span>
<span class="n">PASSED</span>
<span class="o">==============================================================</span>
<span class="n">make</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">Leaving</span> <span class="n">directory</span> <span class="s1">&#39;/gpfs20/shared/src/AMBER/amber20/amber20_src/test/cuda&#39;</span>

<span class="n">Finished</span> <span class="n">CUDA</span> <span class="n">test</span> <span class="n">suite</span> <span class="k">for</span> <span class="n">Amber</span> <span class="mi">20</span> <span class="n">at</span> <span class="n">Wed</span> <span class="n">May</span> <span class="mi">26</span> <span class="mi">11</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">28</span> <span class="n">EDT</span> <span class="mf">2021.</span>

<span class="mi">242</span> <span class="n">file</span> <span class="n">comparisons</span> <span class="n">passed</span>
<span class="mi">7</span> <span class="n">file</span> <span class="n">comparisons</span> <span class="n">failed</span> <span class="p">(</span><span class="mi">1</span> <span class="n">of</span> <span class="n">which</span> <span class="n">can</span> <span class="n">be</span> <span class="n">ignored</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">tests</span> <span class="n">experienced</span> <span class="n">errors</span>

<span class="o">==&gt;</span> <span class="o">/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">amber</span><span class="o">/</span><span class="mi">20</span><span class="n">_gcc93_mpic341_cuda</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">test_amber_cuda_parallel</span><span class="o">/</span><span class="mi">2021</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26_11</span><span class="o">-</span><span class="mi">42</span><span class="o">-</span><span class="mf">11.</span><span class="n">log</span> <span class="o">&lt;==</span>
<span class="n">Note</span><span class="p">:</span> <span class="n">The</span> <span class="n">following</span> <span class="n">floating</span><span class="o">-</span><span class="n">point</span> <span class="n">exceptions</span> <span class="n">are</span> <span class="n">signalling</span><span class="p">:</span> <span class="n">IEEE_DENORMAL</span>
<span class="n">Note</span><span class="p">:</span> <span class="n">The</span> <span class="n">following</span> <span class="n">floating</span><span class="o">-</span><span class="n">point</span> <span class="n">exceptions</span> <span class="n">are</span> <span class="n">signalling</span><span class="p">:</span> <span class="n">IEEE_DENORMAL</span>
<span class="n">Note</span><span class="p">:</span> <span class="n">The</span> <span class="n">following</span> <span class="n">floating</span><span class="o">-</span><span class="n">point</span> <span class="n">exceptions</span> <span class="n">are</span> <span class="n">signalling</span><span class="p">:</span> <span class="n">IEEE_DENORMAL</span>
<span class="n">diffing</span> <span class="n">mdout</span><span class="o">.</span><span class="n">pme</span><span class="o">.</span><span class="n">gamd3</span><span class="o">.</span><span class="n">GPU_DPFP</span> <span class="k">with</span> <span class="n">mdout</span><span class="o">.</span><span class="n">pme</span><span class="o">.</span><span class="n">gamd3</span>
<span class="n">PASSED</span>
<span class="o">==============================================================</span>
<span class="n">make</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">Leaving</span> <span class="n">directory</span> <span class="s1">&#39;/gpfs20/shared/src/AMBER/amber20/amber20_src/test/cuda&#39;</span>
<span class="mi">179</span> <span class="n">file</span> <span class="n">comparisons</span> <span class="n">passed</span>
<span class="mi">43</span> <span class="n">file</span> <span class="n">comparisons</span> <span class="n">failed</span> <span class="p">(</span><span class="mi">3</span> <span class="n">of</span> <span class="n">which</span> <span class="n">can</span> <span class="n">be</span> <span class="n">ignored</span><span class="p">)</span>
<span class="mi">2</span> <span class="n">tests</span> <span class="n">experienced</span> <span class="n">errors</span>
</pre></div>
</div>
</div>
<div class="section" id="gcc-11-1-serial">
<h3>GCC 11.1 (Serial)<a class="headerlink" href="#gcc-11-1-serial" title="Permalink to this headline">¶</a></h3>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc111_serial
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU -DDISABLE_TOOLS=&quot;gbnsr6;cifparse;gbnsr6;sff&quot; \
  -DCMAKE_Fortran_FLAGS=&quot;-fallow-invalid-boz -fallow-argument-mismatch&quot; \
  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/11.1.0/lib/libbz2.a \
  -DOPENMP=FALSE -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="gcc-11-1-openmp">
<h3>GCC 11.1 (OpenMP)<a class="headerlink" href="#gcc-11-1-openmp" title="Permalink to this headline">¶</a></h3>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc111_openmp
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU -DDISABLE_TOOLS=&quot;gbnsr6;cifparse;gbnsr6;sff&quot; \
  -DCMAKE_Fortran_FLAGS=&quot;-fallow-invalid-boz -fallow-argument-mismatch&quot; \
  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/11.1.0/lib/libbz2.a \
  -DOPENMP=TRUE -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="gcc-11-1-openmpi-4-1-1">
<h3>GCC 11.1 (OpenMPI 4.1.1)<a class="headerlink" href="#gcc-11-1-openmpi-4-1-1" title="Permalink to this headline">¶</a></h3>
<p>Loading the modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">lang</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cpython_3</span><span class="o">.</span><span class="mf">9.5</span><span class="n">_gcc111</span> <span class="n">parallel</span><span class="o">/</span><span class="n">openmpi</span><span class="o">/</span><span class="mf">4.1</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc111</span>
</pre></div>
</div>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_gcc111_ompi411
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=GNU -DDISABLE_TOOLS=&quot;gbnsr6;cifparse;gbnsr6;sff&quot; \
  -DCMAKE_Fortran_FLAGS=&quot;-fallow-invalid-boz -fallow-argument-mismatch&quot; \
  -DBZIP2_LIBRARIES=/shared/software/lang/gcc/11.1.0/lib/libbz2.a \
  -DOPENMP=FALSE -DMPI=TRUE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="intel-compilers-2021-serial">
<h3>Intel Compilers 2021 (Serial)<a class="headerlink" href="#intel-compilers-2021-serial" title="Permalink to this headline">¶</a></h3>
<p>Loading the modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.21</span><span class="o">.</span><span class="mi">1</span> <span class="n">compiler</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">mpi</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">mkl</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_intel21_serial
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=INTEL -DDISABLE_TOOLS=&quot;reduce&quot; \
  -DBISON_EXECUTABLE=/shared/software/lang/gcc/9.3.0/bin/bison \
  -DOPENMP=FALSE -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="intel-compilers-2021-openmp">
<h3>Intel Compilers 2021 (OpenMP)<a class="headerlink" href="#intel-compilers-2021-openmp" title="Permalink to this headline">¶</a></h3>
<p>Loading the modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.21</span><span class="o">.</span><span class="mi">1</span> <span class="n">compiler</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">mpi</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">mkl</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_intel21_openmp
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=INTEL -DDISABLE_TOOLS=&quot;reduce&quot; \
  -DBISON_EXECUTABLE=/shared/software/lang/gcc/9.3.0/bin/bison \
  -DOPENMP=TRUE -DMPI=FALSE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="intel-compilers-2021-intel-mpi-2021">
<h3>Intel Compilers 2021 (Intel MPI 2021)<a class="headerlink" href="#intel-compilers-2021-intel-mpi-2021" title="Permalink to this headline">¶</a></h3>
<p>Loading the modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.21</span><span class="o">.</span><span class="mi">1</span> <span class="n">compiler</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">mpi</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">mkl</span><span class="o">/</span><span class="mf">2021.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>The variable defining the PREFIX will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AMBER_PREFIX=$(dirname $(dirname `pwd`))
PREFIX=/shared/software/atomistic/amber/20_intel21_impi21
</pre></div>
</div>
<p>This is the PREFIX that we will use for the OpenMP compilation.
The other change is inside the block for running cmake for the Linux build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#  Assume this is Linux:

cmake $AMBER_PREFIX/amber20_src \
  -DCMAKE_INSTALL_PREFIX=$PREFIX \
  -DCOMPILER=INTEL -DDISABLE_TOOLS=&quot;reduce&quot; \
  -DBISON_EXECUTABLE=/shared/software/lang/gcc/9.3.0/bin/bison \
  -DOPENMP=FALSE -DMPI=TRUE -DCUDA=FALSE -DINSTALL_TESTS=TRUE \
  -DDOWNLOAD_MINICONDA=TRUE -DMINICONDA_USE_PY3=TRUE \
  2&gt;&amp;1 | tee  cmake.log
</pre></div>
</div>
<p>After this execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_cmake</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="intel-compilers-2021-cuda">
<h3>Intel Compilers 2021 (CUDA)<a class="headerlink" href="#intel-compilers-2021-cuda" title="Permalink to this headline">¶</a></h3>
<p>Nvidia CUDA compiler nvcc does not support Intel Compilers 2021 as the base compiler for CUDA builds.</p>
</div>
<div class="section" id="running-tests">
<h3>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h3>
<p>To run the testsuite, the modulefile needs to be created and loaded. The module must set the variable <code class="docutils literal notranslate"><span class="pre">$AMBERHOME</span></code> needed to run the tests.
Go to the folder <code class="docutils literal notranslate"><span class="pre">amber20_src/test</span></code> that contains the tests.
For the parallel tests, set the variable <code class="docutils literal notranslate"><span class="pre">$DO_PARALLEL</span></code> to the right command for running MPI executions, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">DO_PARALLEL</span><span class="o">=</span><span class="s2">&quot;mpirun -np 4&quot;</span>
</pre></div>
</div>
<p>These are the results of several tests:</p>
<p>GCC 9.3 Serial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; ./test_amber_serial.sh
...
...
Finished serial test suite for Amber 20 at Sat Aug 21 17:52:10 EDT 2021.
                                                                                                                                                                                                            196 file comparisons passed
0 file comparisons failed
0 tests experienced errors
Test log file saved as /shared/software/atomistic/amber/20_gcc93_serial/logs/test_amber_serial/2021-08-21_17-45-18.log
No test diffs to save!
</pre></div>
</div>
<p>GCC 9.3 OpenMP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; ./test_amber_serial.sh
...
...
Finished serial test suite for Amber 20 at Sat Aug 21 18:04:09 EDT 2021.

196 file comparisons passed
0 file comparisons failed
0 tests experienced errors
Test log file saved as /shared/software/atomistic/amber/20_gcc93_openmp/logs/test_amber_serial/2021-08-21_17-57-23.log
No test diffs to save!
</pre></div>
</div>
<p>GCC 9.3 CUDA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; ./test_amber_cuda_serial.sh
...
...
Finished CUDA test suite for Amber 20 at Sat Aug 21 18:15:52 EDT 2021.

243 file comparisons passed
6 file comparisons failed (1 of which can be ignored)
0 tests experienced errors
Test log file saved as /shared/software/atomistic/amber/20_gcc93_cuda113/logs/test_amber_cuda/2021-08-21_18-12-26.log
Test diffs file saved as /shared/software/atomistic/amber/20_gcc93_cuda113/logs/test_amber_cuda/2021-08-21_18-12-26.diff
</pre></div>
</div>
<p>GCC 9.3 MPICH 3.4.1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; export DO_PARALLEL=&quot;mpirun -np 8&quot;
$&gt; ./test_amber_parallel.sh
...
...
Finished parallel test suite for Amber 20 on Sat Aug 21 18:31:15 EDT 2021.
Some tests require 4 threads to run, while some will not
run with more than 2.  Please run further parallel tests with the appropriate number of processors. See /shared/software/atomistic/amber/20_gcc93_mpic341/test/README.

274 file comparisons passed
4 file comparisons failed (1 of which can be ignored)
0 tests experienced an error
Test log file saved as /shared/software/atomistic/amber/20_gcc93_mpic341/logs/test_amber_parallel/2021-08-21_18-27-41.log
Test diffs file saved as /shared/software/atomistic/amber/20_gcc93_mpic341/logs/test_amber_parallel/2021-08-21_18-27-41.diff
</pre></div>
</div>
<p>GCC 9.3 OpenMP + MPI + CUDA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; cat $PBS_NODEFILE | uniq &gt; NODEFILE
$&gt; export DO_PARALLEL=&quot;mpirun -np 2 -f /shared/src/AMBER/amber20/amber20_src/test/NODEFILE&quot;
$&gt; ./test_amber_cuda_parallel.sh
...
...
135 file comparisons passed
13 file comparisons failed (1 of which can be ignored)
0 tests experienced errors
Test log file saved as /shared/software/atomistic/amber/20_gcc93_mpic341_cuda113/logs/test_amber_cuda_parallel/2021-08-21_19-27-18.log
Test diffs file saved as /shared/software/atomistic/amber/20_gcc93_mpic341_cuda113/logs/test_amber_cuda_parallel/2021-08-21_19-27-18.diff
</pre></div>
</div>
</div>
</div>
<div class="section" id="gromacs">
<h2>Gromacs<a class="headerlink" href="#gromacs" title="Permalink to this headline">¶</a></h2>
<p>Gromacs is a Classical Molecular Dynamics code. The version compiled was 2021.2
Several versions were compiled using GCC 9.3 and 11.1</p>
<div class="section" id="gromacs-2021-2-on-thorny-flat">
<h3>Gromacs 2021.2 on Thorny Flat<a class="headerlink" href="#gromacs-2021-2-on-thorny-flat" title="Permalink to this headline">¶</a></h3>
<p>The download page is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">manual</span><span class="o">.</span><span class="n">gromacs</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
<p>It is a good practice to compile from a separate folder instead of compiling directly alongside with the sources, create a folder <code class="docutils literal notranslate"><span class="pre">build_gcc93_mpic341</span></code> inside the sources:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ftp</span><span class="o">.</span><span class="n">gromacs</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">gromacs</span><span class="o">/</span><span class="n">gromacs</span><span class="o">-</span><span class="mf">2021.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">zxvf</span> <span class="n">gromacs</span><span class="o">-</span><span class="mf">2021.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">cd</span> <span class="n">gromacs</span><span class="o">-</span><span class="mf">2021.2</span><span class="o">/</span>
<span class="n">mkdir</span> <span class="n">build_gcc93_mpic341</span>
<span class="n">cd</span> <span class="n">build_gcc93_mpic341</span>
</pre></div>
</div>
<p>Cmake is only used during configuration and it is not needed at runtime
The modules can be loaded with this command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">purge</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">9.3</span><span class="o">.</span><span class="mi">0</span> <span class="n">parallel</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">1</span><span class="n">_gcc93</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.18</span><span class="o">.</span><span class="mi">3</span> \
<span class="n">lang</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cpython_3</span><span class="o">.</span><span class="mf">9.5</span><span class="n">_gcc93</span> <span class="n">libs</span><span class="o">/</span><span class="n">openblas</span><span class="o">/</span><span class="mf">0.3</span><span class="o">.</span><span class="mi">13</span><span class="n">_gcc93</span>
</pre></div>
</div>
<p>The first configuration is the standard one (Single Precision)</p>
<p>The cmake configuration line was:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DGMX_BUILD_OWN_FFTW</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DREGRESSIONTEST_DOWNLOAD</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DGMX_MPI</span><span class="o">=</span><span class="n">on</span> \
  <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpicxx</span> \
  <span class="o">-</span><span class="n">DGMX_LAPACK_USER</span><span class="o">=</span><span class="s2">&quot;-L$</span><span class="si">{MD_OPENBLAS}</span><span class="s2">/lib -lopenblas&quot;</span> \
  <span class="o">-</span><span class="n">DGMX_BLAS_USER</span><span class="o">=</span><span class="s2">&quot;-L$</span><span class="si">{MD_OPENBLAS}</span><span class="s2">/lib -lopenblas&quot;</span> \
  <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">gromacs</span><span class="o">/</span><span class="mf">2021.2</span><span class="n">_gcc93_mpic341</span> <span class="o">..</span>
</pre></div>
</div>
<p>The results of the tests were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">...</span>
<span class="mi">70</span><span class="o">/</span><span class="mi">73</span> <span class="n">Test</span> <span class="c1">#70: regressiontests/complex ...............   Passed  135.38 sec</span>
      <span class="n">Start</span> <span class="mi">71</span><span class="p">:</span> <span class="n">regressiontests</span><span class="o">/</span><span class="n">freeenergy</span>
<span class="mi">71</span><span class="o">/</span><span class="mi">73</span> <span class="n">Test</span> <span class="c1">#71: regressiontests/freeenergy ............   Passed   34.09 sec</span>
      <span class="n">Start</span> <span class="mi">72</span><span class="p">:</span> <span class="n">regressiontests</span><span class="o">/</span><span class="n">rotation</span>
<span class="mi">72</span><span class="o">/</span><span class="mi">73</span> <span class="n">Test</span> <span class="c1">#72: regressiontests/rotation ..............   Passed   28.83 sec</span>
      <span class="n">Start</span> <span class="mi">73</span><span class="p">:</span> <span class="n">regressiontests</span><span class="o">/</span><span class="n">essentialdynamics</span>
<span class="mi">73</span><span class="o">/</span><span class="mi">73</span> <span class="n">Test</span> <span class="c1">#73: regressiontests/essentialdynamics .....   Passed   10.23 sec</span>

<span class="mi">100</span><span class="o">%</span> <span class="n">tests</span> <span class="n">passed</span><span class="p">,</span> <span class="mi">0</span> <span class="n">tests</span> <span class="n">failed</span> <span class="n">out</span> <span class="n">of</span> <span class="mi">73</span>

<span class="n">Label</span> <span class="n">Time</span> <span class="n">Summary</span><span class="p">:</span>
<span class="n">GTest</span>              <span class="o">=</span> <span class="mf">108.89</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">67</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">IntegrationTest</span>    <span class="o">=</span>  <span class="mf">32.96</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">20</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">MpiTest</span>            <span class="o">=</span>  <span class="mf">52.50</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">10</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">SlowTest</span>           <span class="o">=</span>  <span class="mf">57.26</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">8</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">UnitTest</span>           <span class="o">=</span>  <span class="mf">18.67</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">39</span> <span class="n">tests</span><span class="p">)</span>

<span class="n">Total</span> <span class="n">Test</span> <span class="n">time</span> <span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">=</span> <span class="mf">317.75</span> <span class="n">sec</span>
<span class="p">[</span><span class="mi">100</span><span class="o">%</span><span class="p">]</span> <span class="n">Built</span> <span class="n">target</span> <span class="n">run</span><span class="o">-</span><span class="n">ctest</span><span class="o">-</span><span class="n">nophys</span>
<span class="n">Scanning</span> <span class="n">dependencies</span> <span class="n">of</span> <span class="n">target</span> <span class="n">check</span>
<span class="p">[</span><span class="mi">100</span><span class="o">%</span><span class="p">]</span> <span class="n">Built</span> <span class="n">target</span> <span class="n">check</span>
</pre></div>
</div>
<p>The second configuration enables the double precision for gromacs:</p>
<p>The cmake configuration line was:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DGMX_BUILD_OWN_FFTW</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DREGRESSIONTEST_DOWNLOAD</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DGMX_MPI</span><span class="o">=</span><span class="n">on</span>   <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpicxx</span>   <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">gromacs</span><span class="o">/</span><span class="mf">2021.2</span><span class="n">_double_gcc93_mpic341</span> <span class="o">-</span><span class="n">DGMX_LAPACK_USER</span><span class="o">=</span><span class="s2">&quot;-L$</span><span class="si">{MD_OPENBLAS}</span><span class="s2">/lib -lopenblas&quot;</span> <span class="o">-</span><span class="n">DGMX_BLAS_USER</span><span class="o">=</span><span class="s2">&quot;-L$</span><span class="si">{MD_OPENBLAS}</span><span class="s2">/lib -lopenblas&quot;</span> <span class="o">-</span><span class="n">DGMX_DOUBLE</span><span class="o">=</span><span class="n">on</span> <span class="o">..</span>
</pre></div>
</div>
<p>The results of the tests were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">98</span><span class="o">%</span> <span class="n">tests</span> <span class="n">passed</span><span class="p">,</span> <span class="mi">1</span> <span class="n">tests</span> <span class="n">failed</span> <span class="n">out</span> <span class="n">of</span> <span class="mi">46</span>

<span class="n">Label</span> <span class="n">Time</span> <span class="n">Summary</span><span class="p">:</span>
<span class="n">GTest</span>              <span class="o">=</span> <span class="mf">117.18</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">40</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">IntegrationTest</span>    <span class="o">=</span>  <span class="mf">13.81</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">5</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">MpiTest</span>            <span class="o">=</span>   <span class="mf">2.60</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">3</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">SlowTest</span>           <span class="o">=</span>  <span class="mf">12.88</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">1</span> <span class="n">test</span><span class="p">)</span>
<span class="n">UnitTest</span>           <span class="o">=</span>  <span class="mf">90.49</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">34</span> <span class="n">tests</span><span class="p">)</span>

<span class="n">Total</span> <span class="n">Test</span> <span class="n">time</span> <span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2075.93</span> <span class="n">sec</span>
</pre></div>
</div>
</div>
<div class="section" id="gromacs-5-1-5-on-thorny-flat">
<h3>Gromacs 5.1.5 on Thorny Flat<a class="headerlink" href="#gromacs-5-1-5-on-thorny-flat" title="Permalink to this headline">¶</a></h3>
<p>The modules used were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">lang</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">2018</span> <span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.18</span><span class="o">.</span><span class="mi">3</span> <span class="n">libs</span><span class="o">/</span><span class="n">boost</span><span class="o">/</span><span class="mf">1.73</span>
</pre></div>
</div>
<p>Cmake is only used during configuration and it is not needed at runtime
The configuration line for cmake is executed on a folder created to contain the compiled code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">build_intel18</span>
<span class="n">cd</span> <span class="n">build_intel18</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">DGMX_BUILD_OWN_FFTW</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DREGRESSIONTEST_DOWNLOAD</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DGMX_MPI</span><span class="o">=</span><span class="n">on</span> \
<span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpiicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpiicpc</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">gromacs</span><span class="o">/</span><span class="mf">5.1</span><span class="o">.</span><span class="mi">5</span><span class="n">_intel18</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j12</span>
<span class="n">make</span> <span class="n">check</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>A similar compilation was done using Intel 2019 compilers.
One test fails from the test suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">96</span><span class="o">%</span> <span class="n">tests</span> <span class="n">passed</span><span class="p">,</span> <span class="mi">1</span> <span class="n">tests</span> <span class="n">failed</span> <span class="n">out</span> <span class="n">of</span> <span class="mi">26</span>

<span class="n">Label</span> <span class="n">Time</span> <span class="n">Summary</span><span class="p">:</span>
<span class="n">GTest</span>                 <span class="o">=</span>   <span class="mf">2.29</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">17</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">IntegrationTest</span>       <span class="o">=</span>   <span class="mf">2.01</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">2</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">MpiIntegrationTest</span>    <span class="o">=</span>   <span class="mf">0.56</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">1</span> <span class="n">test</span><span class="p">)</span>
<span class="n">UnitTest</span>              <span class="o">=</span>   <span class="mf">2.29</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">17</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">Total</span> <span class="n">Test</span> <span class="n">time</span> <span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">=</span> <span class="mf">120.90</span> <span class="n">secs</span><span class="o">.</span>

<span class="n">The</span> <span class="n">following</span> <span class="n">tests</span> <span class="n">FAILED</span><span class="p">:</span>
     <span class="mi">17</span> <span class="o">-</span> <span class="n">SelectionUnitTests</span> <span class="p">(</span><span class="n">Failed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="gromacs-2019-4-on-spruce-knob">
<h3>Gromacs 2019.4 on Spruce Knob<a class="headerlink" href="#gromacs-2019-4-on-spruce-knob" title="Permalink to this headline">¶</a></h3>
<p>The modules used were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">8.2</span><span class="o">.</span><span class="mi">0</span>
<span class="n">dev</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="mf">3.15</span><span class="o">.</span><span class="mi">4</span>
<span class="n">parallel</span><span class="o">/</span><span class="n">openmpi</span><span class="o">/</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">4</span><span class="n">_gcc82</span>
</pre></div>
</div>
<p>Cmake is only used during configuration and it is not needed at runtime</p>
<p>The first configuration is the standard one (Single Precision)</p>
<p>The cmake configuration line was:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DGMX_BUILD_OWN_FFTW</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DREGRESSIONTEST_DOWNLOAD</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DGMX_MPI</span><span class="o">=</span><span class="n">on</span> \
<span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpicxx</span> <span class="o">-</span><span class="n">DGMX_HWLOC</span><span class="o">=</span><span class="n">off</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">gromacs</span><span class="o">/</span><span class="mf">2019.4</span><span class="n">_gcc82</span> <span class="o">..</span>
</pre></div>
</div>
<p>The results of the tests were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">98</span><span class="o">%</span> <span class="n">tests</span> <span class="n">passed</span><span class="p">,</span> <span class="mi">1</span> <span class="n">tests</span> <span class="n">failed</span> <span class="n">out</span> <span class="n">of</span> <span class="mi">46</span>

<span class="n">Label</span> <span class="n">Time</span> <span class="n">Summary</span><span class="p">:</span>
<span class="n">GTest</span>              <span class="o">=</span> <span class="mf">162.72</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">40</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">IntegrationTest</span>    <span class="o">=</span>  <span class="mf">11.37</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">5</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">MpiTest</span>            <span class="o">=</span>  <span class="mf">12.06</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">3</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">SlowTest</span>           <span class="o">=</span>  <span class="mf">13.23</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">1</span> <span class="n">test</span><span class="p">)</span>
<span class="n">UnitTest</span>           <span class="o">=</span> <span class="mf">138.12</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">34</span> <span class="n">tests</span><span class="p">)</span>

<span class="n">Total</span> <span class="n">Test</span> <span class="n">time</span> <span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2085.68</span> <span class="n">sec</span>

<span class="n">The</span> <span class="n">following</span> <span class="n">tests</span> <span class="n">FAILED</span><span class="p">:</span>
         <span class="mi">29</span> <span class="o">-</span> <span class="n">GmxPreprocessTests</span> <span class="p">(</span><span class="n">Timeout</span><span class="p">)</span>
</pre></div>
</div>
<p>The second configuration enables the double precision for gromacs:</p>
<p>The cmake configuration line was:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DGMX_BUILD_OWN_FFTW</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DREGRESSIONTEST_DOWNLOAD</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DGMX_MPI</span><span class="o">=</span><span class="n">on</span> \
<span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpicxx</span> <span class="o">-</span><span class="n">DGMX_HWLOC</span><span class="o">=</span><span class="n">off</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">atomistic</span><span class="o">/</span><span class="n">gromacs</span><span class="o">/</span><span class="mf">2019.4</span><span class="n">_double_gcc82</span> \
<span class="o">-</span><span class="n">DGMX_DOUBLE</span><span class="o">=</span><span class="n">on</span> <span class="o">..</span>
</pre></div>
</div>
<p>The results of the tests were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">98</span><span class="o">%</span> <span class="n">tests</span> <span class="n">passed</span><span class="p">,</span> <span class="mi">1</span> <span class="n">tests</span> <span class="n">failed</span> <span class="n">out</span> <span class="n">of</span> <span class="mi">46</span>

<span class="n">Label</span> <span class="n">Time</span> <span class="n">Summary</span><span class="p">:</span>
<span class="n">GTest</span>              <span class="o">=</span>  <span class="mf">85.42</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">40</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">IntegrationTest</span>    <span class="o">=</span>  <span class="mf">10.96</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">5</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">MpiTest</span>            <span class="o">=</span>   <span class="mf">1.01</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">3</span> <span class="n">tests</span><span class="p">)</span>
<span class="n">SlowTest</span>           <span class="o">=</span>  <span class="mf">23.99</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">1</span> <span class="n">test</span><span class="p">)</span>
<span class="n">UnitTest</span>           <span class="o">=</span>  <span class="mf">50.47</span> <span class="n">sec</span><span class="o">*</span><span class="n">proc</span> <span class="p">(</span><span class="mi">34</span> <span class="n">tests</span><span class="p">)</span>

<span class="n">Total</span> <span class="n">Test</span> <span class="n">time</span> <span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">=</span> <span class="mf">493.51</span> <span class="n">sec</span>

<span class="n">The</span> <span class="n">following</span> <span class="n">tests</span> <span class="n">FAILED</span><span class="p">:</span>
         <span class="mi">29</span> <span class="o">-</span> <span class="n">GmxPreprocessTests</span> <span class="p">(</span><span class="n">Timeout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lammps">
<h2>LAMMPS<a class="headerlink" href="#lammps" title="Permalink to this headline">¶</a></h2>
<p>LAMMPS is a packages for atomistic and particle simulations. The latests stable version by the time (May 2021) is from October 29, 2020. LAMMPS was compiled using these modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lang</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="mf">11.1</span><span class="o">.</span><span class="mi">0</span>
<span class="n">parallel</span><span class="o">/</span><span class="n">openmpi</span><span class="o">/</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">6</span><span class="n">_gcc111</span>
<span class="n">libs</span><span class="o">/</span><span class="n">fftw</span><span class="o">/</span><span class="mf">3.3</span><span class="o">.</span><span class="mi">9</span><span class="n">_gcc111</span>
<span class="n">libs</span><span class="o">/</span><span class="n">hdf5</span><span class="o">/</span><span class="mf">1.12</span><span class="o">.</span><span class="mi">0</span><span class="n">_gcc111</span>
</pre></div>
</div>
<p>LAMMPS was compiled using GCC 11.1, OpenMPI 3.4.1, FFTW 3.3.9, and HDF5 1.12</p>
<p>The first step is to download the code from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">lammps</span><span class="o">.</span><span class="n">sandia</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">tars</span><span class="o">/</span><span class="n">lammps</span><span class="o">-</span><span class="mi">29</span><span class="n">Oct20</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Uncompress the code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">zxvf</span> <span class="n">lammps</span><span class="o">-</span><span class="mi">29</span><span class="n">Oct20</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Change to the src folder inside the uncompressed folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">lammps</span><span class="o">-</span><span class="mi">29</span><span class="n">Oct20</span><span class="o">/</span><span class="n">src</span>
</pre></div>
</div>
<p>You need a customized Makefile for compiling LAMMPS with the right compilers and libraries. The file is called Makefile.gcc111_ompi316 and must be located at
<code class="docutils literal notranslate"><span class="pre">src/MAKE</span></code>, the content of the file follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># mpi = MPI with its default compiler

SHELL = /bin/sh

# ---------------------------------------------------------------------
# compiler/linker settings
# specify flags and libraries needed for your compiler

CC =            mpicxx
CCFLAGS =       -g -O3
SHFLAGS =       -fPIC
DEPFLAGS =      -M

LINK =          mpicxx
LINKFLAGS =     -g -O3
LIB =
SIZE =          size

ARCHIVE =       ar
ARFLAGS =       -rc
SHLIBFLAGS =    -shared

# ---------------------------------------------------------------------
# LAMMPS-specific settings, all OPTIONAL
# specify settings for LAMMPS features you will use
# if you change any -D setting, do full re-compile after &quot;make clean&quot;

# LAMMPS ifdef settings
# see possible settings in Section 3.5 of the manual

LMP_INC =       -DLAMMPS_GZIP -DLAMMPS_MEMALIGN=64  # -DLAMMPS_CXX98

# MPI library
# see discussion in Section 3.4 of the manual
# MPI wrapper compiler/linker can provide this info
# can point to dummy MPI library in src/STUBS as in Makefile.serial
# use -D MPICH and OMPI settings in INC to avoid C++ lib conflicts
# INC = path for mpi.h, MPI compiler settings
# PATH = path for MPI library
# LIB = name of MPI library

MPI_INC = -DMPICH_SKIP_MPICXX -DOMPI_SKIP_MPICXX=1
MPI_PATH =
MPI_LIB =

# FFT library
# see discussion in Section 3.5.2 of manual
# can be left blank to use provided KISS FFT library
# INC = -DFFT setting, e.g. -DFFT_FFTW, FFT compiler settings
# PATH = path for FFT library
# LIB = name of FFT library

FFT_INC = -DFFT_FFTW3
FFT_PATH =
FFT_LIB =  -L${MD_FFTW}/lib -lfftw3

# JPEG and/or PNG library
# see discussion in Section 3.5.4 of manual
# only needed if -DLAMMPS_JPEG or -DLAMMPS_PNG listed with LMP_INC
# INC = path(s) for jpeglib.h and/or png.h
# PATH = path(s) for JPEG library and/or PNG library
# LIB = name(s) of JPEG library and/or PNG library

JPG_INC = -I${MD_GCC}/include
JPG_PATH = -L${MD_GCC}/lib
JPG_LIB = -lpng -ljpeg -lz

# ---------------------------------------------------------------------
# build rules and dependencies
# do not edit this section

include Makefile.package.settings
include Makefile.package

EXTRA_INC = $(LMP_INC) $(PKG_INC) $(MPI_INC) $(FFT_INC) $(JPG_INC) $(PKG_SYSINC)
EXTRA_PATH = $(PKG_PATH) $(MPI_PATH) $(FFT_PATH) $(JPG_PATH) $(PKG_SYSPATH)
EXTRA_LIB = $(PKG_LIB) $(MPI_LIB) $(FFT_LIB) $(JPG_LIB) $(PKG_SYSLIB)
EXTRA_CPP_DEPENDS = $(PKG_CPP_DEPENDS)
EXTRA_LINK_DEPENDS = $(PKG_LINK_DEPENDS)

# Path to src files

vpath %.cpp ..
vpath %.h ..

# Link target

$(EXE): main.o $(LMPLIB) $(EXTRA_LINK_DEPENDS)
        $(LINK) $(LINKFLAGS) main.o $(EXTRA_PATH) $(LMPLINK) $(EXTRA_LIB) $(LIB) -o $@
        $(SIZE) $@

# Library targets

$(ARLIB): $(OBJ) $(EXTRA_LINK_DEPENDS)
        @rm -f ../$(ARLIB)
        $(ARCHIVE) $(ARFLAGS) ../$(ARLIB) $(OBJ)
        @rm -f $(ARLIB)
        @ln -s ../$(ARLIB) $(ARLIB)

$(SHLIB): $(OBJ) $(EXTRA_LINK_DEPENDS)
        $(CC) $(CCFLAGS) $(SHFLAGS) $(SHLIBFLAGS) $(EXTRA_PATH) -o ../$(SHLIB) \
                $(OBJ) $(EXTRA_LIB) $(LIB)
        @rm -f $(SHLIB)
        @ln -s ../$(SHLIB) $(SHLIB)

# Compilation rules

%.o:%.cpp
        $(CC) $(CCFLAGS) $(SHFLAGS) $(EXTRA_INC) -c $&lt;

# Individual dependencies

depend : fastdep.exe $(SRC)
        @./fastdep.exe $(EXTRA_INC) -- $^ &gt; .depend || exit 1

fastdep.exe: ../DEPEND/fastdep.c
        cc -O -o $@ $&lt;

sinclude .depend
</pre></div>
</div>
<p>The file should be located inside “src/MAKE” or “src/MAKE/MACHINES”.
Now inside the “src” folder, there is a Makefile that allow you to select which packages will be compiled along side LAMMPS. A good selection comes from adding all followed by removing those depend on libraries and after adding a few:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">yes</span><span class="o">-</span><span class="nb">all</span>
<span class="n">make</span> <span class="n">no</span><span class="o">-</span><span class="n">lib</span>
<span class="n">make</span> <span class="n">yes</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">reaxc</span>
<span class="n">make</span> <span class="n">yes</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">molfile</span>
</pre></div>
</div>
<p>A few external subpackages must be configured first. We want to add HDF5 and COLVARS with the following lines compiling the corresponding subpackages and enabling them for LAMMPS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">lib</span><span class="o">/</span><span class="n">h5md</span>
<span class="n">make</span> <span class="o">-</span><span class="n">f</span> <span class="n">Makefile</span><span class="o">.</span><span class="n">h5cc</span>
<span class="n">cd</span> <span class="o">../../</span><span class="n">src</span><span class="o">/</span>
<span class="n">make</span> <span class="n">yes</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">h5md</span>
<span class="n">make</span> <span class="n">lib</span><span class="o">-</span><span class="n">colvars</span> <span class="n">args</span><span class="o">=</span><span class="s2">&quot;-m mpi&quot;</span>
<span class="n">make</span> <span class="n">yes</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">colvars</span>
</pre></div>
</div>
<p>And LAMMPS itself after that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">gcc111_ompi316</span>
</pre></div>
</div>
<p>After compiled the binary is called <code class="docutils literal notranslate"><span class="pre">lmp_gcc82_ompi31</span></code></p>
<p>For testing the build, you can use one of the benchmarks inside the <cite>bench</cite>
folder. The benchmark runs on one of the compute nodes using 40 cores. The simulation involves more than 10 million atoms.
The command line is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">40</span> <span class="n">lmp_mpi</span> <span class="o">-</span><span class="n">var</span> <span class="n">x</span> <span class="mi">4</span> <span class="o">-</span><span class="n">var</span> <span class="n">y</span> <span class="mi">8</span> <span class="o">-</span><span class="n">var</span> <span class="n">z</span> <span class="mi">10</span> <span class="o">-</span><span class="ow">in</span> <span class="ow">in</span><span class="o">.</span><span class="n">rhodo</span><span class="o">.</span><span class="n">scaled</span>
</pre></div>
</div>
<p>This is the final output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Loop</span> <span class="n">time</span> <span class="n">of</span> <span class="mf">303.71</span> <span class="n">on</span> <span class="mi">40</span> <span class="n">procs</span> <span class="k">for</span> <span class="mi">100</span> <span class="n">steps</span> <span class="k">with</span> <span class="mi">10240000</span> <span class="n">atoms</span>

<span class="n">Performance</span><span class="p">:</span> <span class="mf">0.057</span> <span class="n">ns</span><span class="o">/</span><span class="n">day</span><span class="p">,</span> <span class="mf">421.820</span> <span class="n">hours</span><span class="o">/</span><span class="n">ns</span><span class="p">,</span> <span class="mf">0.329</span> <span class="n">timesteps</span><span class="o">/</span><span class="n">s</span>
<span class="mf">99.1</span><span class="o">%</span> <span class="n">CPU</span> <span class="n">use</span> <span class="k">with</span> <span class="mi">40</span> <span class="n">MPI</span> <span class="n">tasks</span> <span class="n">x</span> <span class="n">no</span> <span class="n">OpenMP</span> <span class="n">threads</span>

<span class="n">MPI</span> <span class="n">task</span> <span class="n">timing</span> <span class="n">breakdown</span><span class="p">:</span>
<span class="n">Section</span> <span class="o">|</span>  <span class="nb">min</span> <span class="n">time</span>  <span class="o">|</span>  <span class="n">avg</span> <span class="n">time</span>  <span class="o">|</span>  <span class="nb">max</span> <span class="n">time</span>  <span class="o">|%</span><span class="n">varavg</span><span class="o">|</span> <span class="o">%</span><span class="n">total</span>
<span class="o">---------------------------------------------------------------</span>
<span class="n">Pair</span>    <span class="o">|</span> <span class="mf">201.28</span>     <span class="o">|</span> <span class="mf">205.41</span>     <span class="o">|</span> <span class="mf">210.7</span>      <span class="o">|</span>  <span class="mf">15.7</span> <span class="o">|</span> <span class="mf">67.63</span>
<span class="n">Bond</span>    <span class="o">|</span> <span class="mf">9.4133</span>     <span class="o">|</span> <span class="mf">9.5518</span>     <span class="o">|</span> <span class="mf">9.7418</span>     <span class="o">|</span>   <span class="mf">2.2</span> <span class="o">|</span>  <span class="mf">3.15</span>
<span class="n">Kspace</span>  <span class="o">|</span> <span class="mf">31.517</span>     <span class="o">|</span> <span class="mf">36.816</span>     <span class="o">|</span> <span class="mf">40.964</span>     <span class="o">|</span>  <span class="mf">36.8</span> <span class="o">|</span> <span class="mf">12.12</span>
<span class="n">Neigh</span>   <span class="o">|</span> <span class="mf">36.55</span>      <span class="o">|</span> <span class="mf">36.561</span>     <span class="o">|</span> <span class="mf">36.571</span>     <span class="o">|</span>   <span class="mf">0.1</span> <span class="o">|</span> <span class="mf">12.04</span>
<span class="n">Comm</span>    <span class="o">|</span> <span class="mf">1.3529</span>     <span class="o">|</span> <span class="mf">1.5481</span>     <span class="o">|</span> <span class="mf">1.6872</span>     <span class="o">|</span>   <span class="mf">7.0</span> <span class="o">|</span>  <span class="mf">0.51</span>
<span class="n">Output</span>  <span class="o">|</span> <span class="mf">0.0038965</span>  <span class="o">|</span> <span class="mf">0.0040967</span>  <span class="o">|</span> <span class="mf">0.0043541</span>  <span class="o">|</span>   <span class="mf">0.1</span> <span class="o">|</span>  <span class="mf">0.00</span>
<span class="n">Modify</span>  <span class="o">|</span> <span class="mf">12.757</span>     <span class="o">|</span> <span class="mf">13.067</span>     <span class="o">|</span> <span class="mf">13.53</span>      <span class="o">|</span>   <span class="mf">5.7</span> <span class="o">|</span>  <span class="mf">4.30</span>
<span class="n">Other</span>   <span class="o">|</span>            <span class="o">|</span> <span class="mf">0.7489</span>     <span class="o">|</span>            <span class="o">|</span>       <span class="o">|</span>  <span class="mf">0.25</span>

<span class="n">Nlocal</span><span class="p">:</span>       <span class="mf">256000.0</span> <span class="n">ave</span>      <span class="mi">256004</span> <span class="nb">max</span>      <span class="mi">255996</span> <span class="nb">min</span>
<span class="n">Histogram</span><span class="p">:</span> <span class="mi">8</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">24</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">8</span>
<span class="n">Nghost</span><span class="p">:</span>       <span class="mf">163342.0</span> <span class="n">ave</span>      <span class="mi">163347</span> <span class="nb">max</span>      <span class="mi">163335</span> <span class="nb">min</span>
<span class="n">Histogram</span><span class="p">:</span> <span class="mi">8</span> <span class="mi">0</span> <span class="mi">8</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">8</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">16</span>
<span class="n">Neighs</span><span class="p">:</span>    <span class="mf">9.62247e+07</span> <span class="n">ave</span> <span class="mf">9.65195e+07</span> <span class="nb">max</span> <span class="mf">9.59192e+07</span> <span class="nb">min</span>
<span class="n">Histogram</span><span class="p">:</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">8</span> <span class="mi">0</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">0</span> <span class="mi">4</span> <span class="mi">4</span>

<span class="n">Total</span> <span class="c1"># of neighbors = 3.8489892e+09</span>
<span class="n">Ave</span> <span class="n">neighs</span><span class="o">/</span><span class="n">atom</span> <span class="o">=</span> <span class="mf">375.87785</span>
<span class="n">Ave</span> <span class="n">special</span> <span class="n">neighs</span><span class="o">/</span><span class="n">atom</span> <span class="o">=</span> <span class="mf">7.4318750</span>
<span class="n">Neighbor</span> <span class="nb">list</span> <span class="n">builds</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">Dangerous</span> <span class="n">builds</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">13</span>
</pre></div>
</div>
<p>The table below shows the timings using the different builds created.</p>
<table border="1" class="docutils">
<colgroup>
<col width="63%" />
<col width="37%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Module</td>
<td>Total wall time</td>
</tr>
<tr class="row-even"><td>atomistic/lammps/2020.10.29_gcc111_impi19
atomistic/lammps/2020.10.29_gcc111_ompi316
atomistic/lammps/2020.10.29_gcc93_mpic341</td>
<td>0:04:54
0:05:13
0:05:11</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="609.CHARM++_NAMD.html" class="btn btn-neutral float-right" title="CHARM++ and NAMD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="607.FFT.html" class="btn btn-neutral float-left" title="Fast Fourier Transforms" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, West Virginia University

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>