

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fortran, C and C++ &mdash; WVU-RC 2023.04.03 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python Language" href="502.Python.html" />
    <link rel="prev" title="Scientific Programming" href="500.ScientificProgramming.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WVU-RC
          

          
            
            <img src="../_static/ResearchComputing.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2023.04
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="10.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="20.QuickStart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="30.BasicUsage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="40.AdvancedUsage.html">Advanced Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="500.ScientificProgramming.html">Scientific Programming</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Fortran, C and C++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implementations-of-c-c-and-fortran-compilers">Implementations of C, C++, and Fortran Compilers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-modules">Environment Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiling-source-code">Compiling Source Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-the-gnu-compiler-collection-gcc">Using the GNU Compiler Collection (GCC)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-nvidia-hpc-sdk">Using NVIDIA HPC SDK</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-intel-oneapi-hpc-toolkit">Using Intel® oneAPI HPC Toolkit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="502.Python.html">Python Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="503.R.html">R Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="504.Julia.html">Julia Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="505.Matlab.html">MATLAB</a></li>
<li class="toctree-l2"><a class="reference internal" href="506.Perl.html">Perl Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="507.OpenMP.html">Parallel Programming: OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="508.MPI.html">Parallel Programming: MPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="509.OpenACC.html">Parallel Programming: OpenACC</a></li>
<li class="toctree-l2"><a class="reference internal" href="510.CUDA.html">Parallel Programming: CUDA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="600.SoftAdmin.html">Software Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="700.DomainSpecific.html">Domain Specific Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="80.ClusterSpecific.html">Clusters Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="90.References.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WVU-RC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="500.ScientificProgramming.html">Scientific Programming</a> &raquo;</li>
        
      <li>Fortran, C and C++</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/text/501.Fortran_C_CPP.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="fortran-c-and-c">
<span id="sp-fortran-c-cpp"></span><h1>Fortran, C and C++<a class="headerlink" href="#fortran-c-and-c" title="Permalink to this headline">¶</a></h1>
<p>Scientific computing traces its roots to the very origin of computers.
The first electro-mechanical computers originally were created to compute large numerical calculations much faster than humans can do.
With the evolution of computers came new ways of expressing algorithms in ways closer to human languages but still very close to the internal operation of electronic machines.
With the new electronic computers in the 1950’s, programmers used  assembly language (or assembler language), low-level programming language with a close correspondence between the instructions in the language and the architecture’s machine code instructions.
Programming in assembly is very time consuming and prone to error.
New programming languages evolved to facilitate the translation of algorithms into code, avoiding almost entirely the need for writing in assembler.
Today, three dominant low level languages for scientific computing are Fortran, C and C++.</p>
<p><strong>Fortran</strong> is the oldest of those three, and many algorithms that are fundamental for most problems in science were written in it.
Fortran 77 was for many years the standard de facto for scientific computing and have evolve over the years with Fortran 90, 95, 2003 and 2008.</p>
<p><strong>C</strong> is a general purpose language and used in most of the basic software written in Unix environments. The language itself is not targeted to write scientific programs so it less expressive for vectors and matrices compared to Fortran.</p>
<p><strong>C++</strong> is in many ways an extension of C with high element constructs such as classes. C++ is widely used in desktop applications, games and also scientific applications.</p>
<p>Fortran, C and C++ shared a number of attributes. These languages make use of a compiler that translates the source code into machine code. Parallelization interfaces such as MPI are written with explicit support for those three languages and compiler suites such as GCC, Intel and NVIDIA HPC include those languages by default.</p>
<section id="implementations-of-c-c-and-fortran-compilers">
<h2>Implementations of C, C++, and Fortran Compilers<a class="headerlink" href="#implementations-of-c-c-and-fortran-compilers" title="Permalink to this headline">¶</a></h2>
<p>In an HPC cluster is customary to include compilers for Fortran, C and C++ by default.
On Linux machines the usual compilers are from the GNU Compiler Collection (GCC).
Apart from GCC, there are other vendors of compilers for these three languages.
Each vendor brings its own advantages and particular options to optimize the resulting binaries, support for CPU extensions, support for language extensions and support for various standards of the languages that are standarized and reviewed over time.
Intel® oneAPI HPC Toolkit and NVIDIA HPC SDK are two examples of alternative compilers that are available in many HPC clusters.
Each compiler for the three languages has its own name.
The table below shows the names of the compilers for each of the three languages from each vendor.</p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">Name of compiler commands from different vendors</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 40%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>Language</p></th>
<th class="head"><p>GNU Compiler Collection (GCC)</p></th>
<th class="head"><p>Intel® oneAPI HPC Toolkit</p></th>
<th class="head"><p>NVIDIA HPC SDK</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>Fortran</p></th>
<td><p>gfortran</p></td>
<td><p>ifort</p></td>
<td><p>nvfortran</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>C</p></th>
<td><p>gcc</p></td>
<td><p>icc</p></td>
<td><p>nvc</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>C++</p></th>
<td><p>g++</p></td>
<td><p>icpc</p></td>
<td><p>nvc++</p></td>
</tr>
</tbody>
</table>
<p>The compiler installed by default with the Operating System is usually too old.
That is due to the tendency of having more stable software packages on production systems and that is the case on HPC clusters too.
The versions of those installed compilers are old for the purpose of many scientific packages and do not support recent CPU extensions and language extensions such as OpenMP or OpenACC.
On Thorny Flat the default version of the compilers is 4.8, one way of identifying the version of gcc compilers is running the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; gfortran -v
Using built-in specs.
COLLECT_GCC=gfortran
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.5/lto-wrapper
Target: x86_64-redhat-linux
Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC)
</pre></div>
</div>
</section>
<section id="environment-modules">
<h2>Environment Modules<a class="headerlink" href="#environment-modules" title="Permalink to this headline">¶</a></h2>
<p>It is usually better to use environment modules to access newer versions of GCC or compilers from other vendors such as Intel or NVIDIA.
The table below shows the modules that can be used on Thorny Flat to load the modules for compilers from different vendors and from several versions</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 34%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Vendor</p></th>
<th class="head"><p>Modules</p></th>
<th class="head"><p>Advantages</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GCC</p></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">lang/gcc/9.3.0</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">lang/gcc/12.2.0</span></code></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Standard <em>de-facto</em> on Linux/UNIX</div>
<div class="line">Most codes compile correctly with GCC</div>
<div class="line">Relative good support for OpenMP and AVX</div>
<div class="line">extensions</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Intel</p></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">lang/intel/2018</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">lang/intel/2019</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">compiler/2021.4.0</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">compiler/2022.1.0</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">compiler/2023.1.0</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Compilers that optimize particularly well</div>
<div class="line">on Intel Hardware.</div>
<div class="line">Good support for OpenMP but not OpenACC</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>NVIDIA</p></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">lang/nvidia/nvhpc/22.3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">lang/nvidia/nvhpc/23.3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">lang/nvidia/nvhpc/23.7</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Good support for OpenACC in addition to</div>
<div class="line">OpenMP.</div>
<div class="line">Informative parallelization information</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="compiling-source-code">
<h2>Compiling Source Code<a class="headerlink" href="#compiling-source-code" title="Permalink to this headline">¶</a></h2>
<p>We will now demonstrate how to compile simple codes using compilers from the 3 vendors above.
For doing that, consider the algorithm that compule the <a class="reference external" href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a>.
We have the same algorithm implemented in C and Fortran.
The code can be copied into files and we will proceed to compile it.</p>
<p>To download the code you can execute the following command directly on the cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; wget https://docs.hpc.wvu.edu/_static/sieve.c
$&gt; wget https://docs.hpc.wvu.edu/_static/sieve.f90
</pre></div>
</div>
<p>Or download the files <a class="reference download internal" download="" href="../_downloads/bbe471875eeaa4422d52e81adf74ddbd/sieve.c"><code class="xref download docutils literal notranslate"><span class="pre">sieve.c</span></code></a> and <a class="reference download internal" download="" href="../_downloads/d5db12817b87e1930ee43148b31797c1/sieve.f90"><code class="xref download docutils literal notranslate"><span class="pre">sieve.f90</span></code></a>.</p>
<p>If you download the files to your own computer you can later upload them to the cluster using <a class="reference internal" href="28.FileTransfer.html#qs-file-transfer"><span class="std std-ref">File Transfer (Globus)</span></a></p>
<p>C version (<a class="reference download internal" download="" href="../_downloads/bbe471875eeaa4422d52e81adf74ddbd/sieve.c"><code class="xref download docutils literal notranslate"><span class="pre">sieve.c</span></code></a>)</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">sieve</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="cm">/* Declaring variables */</span><span class="w"></span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="cm">/* Reading command line arguments */</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="cm">/* argc should be 2 for correct execution */</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="cm">/* We print argv[0] assuming it is the program name */</span><span class="w"></span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;usage: %s max_number</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">n</span><span class="o">=</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">      </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Sieve for prime numbers up to %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">sieve</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">sieve</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">n</span><span class="o">/</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">[(</span><span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">counter</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; Total number of primes: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Fortran version (<a class="reference download internal" download="" href="../_downloads/d5db12817b87e1930ee43148b31797c1/sieve.f90"><code class="xref download docutils literal notranslate"><span class="pre">sieve.f90</span></code></a>)</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">module </span><span class="n">str2int_mod</span><span class="w"></span>
<span class="k">contains</span>

<span class="k">  elemental subroutine </span><span class="n">str2int</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">stat</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<span class="w">    </span><span class="c">! Arguments</span>
<span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">str</span><span class="w"></span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">         </span><span class="kd">::</span><span class="w"> </span><span class="nb">int</span>
<span class="nb">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">         </span><span class="kd">::</span><span class="w"> </span><span class="nb">stat</span>

<span class="nb">    </span><span class="k">read</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="nb">stat</span><span class="p">)</span><span class="w">  </span><span class="nb">int</span>
<span class="nb">  </span><span class="k">end subroutine </span><span class="n">str2int</span><span class="w"></span>

<span class="k">end module</span>

<span class="k">program </span><span class="n">sieve</span><span class="w"></span>

<span class="w">  </span><span class="k">use </span><span class="n">str2int_mod</span><span class="w"></span>
<span class="w">  </span><span class="k">implicit none</span>

<span class="k">  </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="nb">stat</span><span class="p">,</span><span class="w"> </span><span class="n">i_max</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="o">=</span><span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">is_prime</span><span class="w"></span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arg</span><span class="w"></span>

<span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="k">do</span>
<span class="k">    call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>

<span class="k">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">       call </span><span class="n">str2int</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span><span class="w"> </span><span class="n">i_max</span><span class="p">,</span><span class="w"> </span><span class="nb">stat</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;Sieve for prime numbers up to&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i_max</span><span class="w"></span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">  end do</span>

<span class="k">  if</span><span class="w"> </span><span class="p">(</span><span class="n">i_max</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">     write</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;Enter the maximum number to search for primes&quot;</span><span class="w"></span>
<span class="w">     </span><span class="k">call exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">end if</span>

<span class="k">  allocate</span><span class="p">(</span><span class="n">is_prime</span><span class="p">(</span><span class="n">i_max</span><span class="p">))</span><span class="w"></span>

<span class="w">  </span><span class="n">is_prime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="n">is_prime</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="kt">real</span><span class="w"> </span><span class="p">(</span><span class="n">i_max</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_prime</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="n">is_prime</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">i_max</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">end do</span>

<span class="k">  if</span><span class="w"> </span><span class="p">(</span><span class="n">i_max</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i_max</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_prime</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(i0, 1x)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">advance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;no&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span>
<span class="k">      do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i_max</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_prime</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="n">counter</span><span class="o">=</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Total number of primes: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="w"></span>
<span class="w">  </span><span class="k">end if</span>

<span class="k">end program </span><span class="n">sieve</span><span class="w"></span>
</pre></div>
</div>
<section id="using-the-gnu-compiler-collection-gcc">
<h3>Using the GNU Compiler Collection (GCC)<a class="headerlink" href="#using-the-gnu-compiler-collection-gcc" title="Permalink to this headline">¶</a></h3>
<p>We will start compiling this code with a modern version of GCC.
Load the module for GCC 12.2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module load lang/gcc/12.2.0
</pre></div>
</div>
<p>The module for GCC 12.2 includes compilers for Fortran, C, and C++.
We can compile the codes above with the commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; gcc sieve.c -o sieve_c_gcc122
$&gt; gfortran sieve.f90 -o sieve_f90_gcc122
</pre></div>
</div>
<p>Now we can execute the binaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; ./sieve_c_gcc122 100000000
 Sieve for prime numbers up to 100000000
 Total number of primes: 5761455

$&gt; ./sieve_f90_gcc122 100000000
 Sieve for prime numbers up to   100000000
 Total number of primes:      5761455
</pre></div>
</div>
</section>
<section id="using-nvidia-hpc-sdk">
<h3>Using NVIDIA HPC SDK<a class="headerlink" href="#using-nvidia-hpc-sdk" title="Permalink to this headline">¶</a></h3>
<p>Another suite that can be use for compiling this code is the NVIDIA HPC SDK
Load the module for NVIDIA HPC SDK 23.7:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module load lang/nvidia/nvhpc/23.7
</pre></div>
</div>
<p>The module for the NVIDIA compilers includes compilers for Fortran, C, and C++.
We can compile the codes above with the commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; nvc sieve.c -o sieve_c_nv237
$&gt; nvfortran sieve.f90 -o sieve_f90_nv237
</pre></div>
</div>
<p>Now we can execute the binaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; ./sieve_c_nv237 100000000
 Sieve for prime numbers up to 100000000
 Total number of primes: 5761455

$&gt; ./sieve_f90_nv237 100000000
 Sieve for prime numbers up to   100000000
 Total number of primes:      5761455
</pre></div>
</div>
</section>
<section id="using-intel-oneapi-hpc-toolkit">
<h3>Using Intel® oneAPI HPC Toolkit<a class="headerlink" href="#using-intel-oneapi-hpc-toolkit" title="Permalink to this headline">¶</a></h3>
<p>There are several suites currently offered by Intel.
Intel® oneAPI HPC Toolkit includes compilers for Fortran, C, and C++.
In addition it also includes Intel MKL which is an optimized implementation of BLAS and LAPACK linear algebra routines.</p>
<p>Load the module for the Intel compilers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module load compiler/2021.4.0
</pre></div>
</div>
<p>The module includes Intel compilers for Fortran, C, and C++.
We can compile the codes above with the commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; icc sieve.c -o sieve_c_intel2021
$&gt; ifort sieve.f90 -o sieve_f90_intel2021
</pre></div>
</div>
<p>Now we can execute the binaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; ./sieve_c_intel2021 100000000
 Sieve for prime numbers up to 100000000
 Total number of primes: 5761455

$&gt; ./sieve_f90_intel2021 100000000
 Sieve for prime numbers up to   100000000
 Total number of primes:      5761455
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="502.Python.html" class="btn btn-neutral float-right" title="Python Language" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="500.ScientificProgramming.html" class="btn btn-neutral float-left" title="Scientific Programming" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, West Virginia University

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>