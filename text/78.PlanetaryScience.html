

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Compiling Planetary Modeling Packages &mdash; WVU-RC 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NAMD" href="79.NAMD.html" />
    <link rel="prev" title="Visualization: VisIt" href="77.Visit.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WVU-RC
          

          
            
            <img src="../_static/ResearchComputing.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="10.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="20.QuickStart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="30.BasicUser.html">For Basic Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="40.AdvancedUser.html">For Advanced Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="500.ScientificProgramming.html">Scientific Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="600.SoftAdmin.html">Software Administration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="70.DomainSpecific.html">Domain Specific Details</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="71.Ansys.html">Engineering: ANSYS Products</a></li>
<li class="toctree-l2"><a class="reference internal" href="72.ANSYSForte.html">Engineering: ANSYS/Forte</a></li>
<li class="toctree-l2"><a class="reference internal" href="73.OpenFoam.html">Engineering: Running OpenFOAM simple tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="75.bowtie2.html">Bioinformatics: Using Bowtie2</a></li>
<li class="toctree-l2"><a class="reference internal" href="77.Visit.html">Visualization: VisIt</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compiling Planetary Modeling Packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#earth-system-modeling-framework-esmf">Earth System Modeling Framework (ESMF)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#download-the-code">Download the code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-the-environment-variables">Setting the environment variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compiling-the-code">Compiling the code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-esmf">Installing ESMF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#thermosphere-ionosphere-electrodynamics-general-circulation-model-tie-gcm">Thermosphere Ionosphere Electrodynamics General Circulation Model (TIE-GCM)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Download the code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#editing-the-make-configuration">Editing the make configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#editing-the-execution-script">Editing the execution script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-global-ionosphere-thermosphere-model-gitm">The Global Ionosphere/Thermosphere Model (GITM)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cloning-the-repository">Cloning the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-the-build">Configuring the build</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-the-code">Building the code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="79.NAMD.html">NAMD</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="80.ClusterSpecific.html">Clusters Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="90.References.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WVU-RC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="70.DomainSpecific.html">Domain Specific Details</a> &raquo;</li>
        
      <li>Compiling Planetary Modeling Packages</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/text/78.PlanetaryScience.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compiling-planetary-modeling-packages">
<h1>Compiling Planetary Modeling Packages<a class="headerlink" href="#compiling-planetary-modeling-packages" title="Permalink to this headline">¶</a></h1>
<p>These instructions describe how to compile various packages for Earth modeling, climate, weather and related applications.</p>
<div class="section" id="earth-system-modeling-framework-esmf">
<h2>Earth System Modeling Framework (ESMF)<a class="headerlink" href="#earth-system-modeling-framework-esmf" title="Permalink to this headline">¶</a></h2>
<p>The Earth System Modeling Framework (ESMF) is high-performance, flexible software infrastructure for building and coupling weather, climate, and related Earth science applications. The ESMF defines an architecture for composing complex, coupled modeling systems and includes data structures and utilities for developing individual models.</p>
<p>We describe how the code was compiled for Thorny Flat using Intel Compiler Suite and MPI libraries.</p>
<div class="section" id="download-the-code">
<h3>Download the code<a class="headerlink" href="#download-the-code" title="Permalink to this headline">¶</a></h3>
<p>The code can be clone with git from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">git</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">esmf</span><span class="o">/</span><span class="n">esmf</span>
</pre></div>
</div>
<p>The code was cloned at this at <code class="docutils literal notranslate"><span class="pre">/shared/src/planetary/esmf</span></code></p>
</div>
<div class="section" id="setting-the-environment-variables">
<h3>Setting the environment variables<a class="headerlink" href="#setting-the-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>The building system is driven by a set of environment variables that need to be exported before executing make. This compilation will be done exclusively using Intel compilers. First we need to load the module for Intel 2018:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">lang</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">2018</span><span class="n">_u4</span>
</pre></div>
</div>
<p>The variables that need to be exported are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">ESMF_DIR</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">planetaryesmf</span>
<span class="n">export</span> <span class="n">ESMF_COMM</span><span class="o">=</span><span class="n">intelmpi</span>
<span class="n">export</span> <span class="n">ESMF_COMPILER</span><span class="o">=</span><span class="n">intel</span>
<span class="n">export</span> <span class="n">ESMF_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">planetary</span><span class="o">/</span><span class="n">esmf</span>
</pre></div>
</div>
</div>
<div class="section" id="compiling-the-code">
<h3>Compiling the code<a class="headerlink" href="#compiling-the-code" title="Permalink to this headline">¶</a></h3>
<p>To compile the code just execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>The compilation takes a while, notice that the first lines shows the values of several environnment variables, the 4 that we just set and a few others internal to the makefile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--------------------------------------------------------------</span>
<span class="n">ESMF_VERSION_STRING</span><span class="p">:</span>    <span class="mf">8.0</span><span class="o">.</span><span class="mi">0</span> <span class="n">beta</span> <span class="n">snapshot</span>
<span class="n">ESMF_8_0_0_beta_snapshot_30</span><span class="o">-</span><span class="mi">48</span><span class="o">-</span><span class="n">g8e8a213</span>
<span class="o">--------------------------------------------------------------</span>
<span class="c1"># On branch master</span>
<span class="n">nothing</span> <span class="n">to</span> <span class="n">commit</span><span class="p">,</span> <span class="n">working</span> <span class="n">directory</span> <span class="n">clean</span>
<span class="o">--------------------------------------------------------------</span>

<span class="o">--------------------------------------------------------------</span>
<span class="n">Make</span> <span class="n">version</span><span class="p">:</span>
<span class="n">GNU</span> <span class="n">Make</span> <span class="mf">3.82</span>
<span class="n">Built</span> <span class="k">for</span> <span class="n">x86_64</span><span class="o">-</span><span class="n">redhat</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2010</span>  <span class="n">Free</span> <span class="n">Software</span> <span class="n">Foundation</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">License</span> <span class="n">GPLv3</span><span class="o">+</span><span class="p">:</span> <span class="n">GNU</span> <span class="n">GPL</span> <span class="n">version</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">later</span> <span class="o">&lt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">gnu</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">gpl</span><span class="o">.</span><span class="n">html</span><span class="o">&gt;</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">free</span> <span class="n">to</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">redistribute</span> <span class="n">it</span><span class="o">.</span>
<span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span> <span class="n">WARRANTY</span><span class="p">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">extent</span> <span class="n">permitted</span> <span class="n">by</span> <span class="n">law</span><span class="o">.</span>

<span class="o">--------------------------------------------------------------</span>
<span class="n">Fortran</span> <span class="n">Compiler</span> <span class="n">version</span><span class="p">:</span>
<span class="n">mpiifort</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">MPI</span> <span class="n">Library</span> <span class="mi">2018</span> <span class="n">Update</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">Linux</span><span class="o">*</span>
<span class="n">Copyright</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2003</span><span class="o">-</span><span class="mi">2018</span><span class="p">,</span> <span class="n">Intel</span> <span class="n">Corporation</span><span class="o">.</span>  <span class="n">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="o">.</span>
<span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Fortran</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="mi">64</span> <span class="n">Compiler</span> <span class="k">for</span> <span class="n">applications</span> <span class="n">running</span> <span class="n">on</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="mi">64</span><span class="p">,</span> <span class="n">Version</span> <span class="mf">18.0</span><span class="o">.</span><span class="mf">5.274</span> <span class="n">Build</span> <span class="mi">20180823</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">1985</span><span class="o">-</span><span class="mi">2018</span> <span class="n">Intel</span> <span class="n">Corporation</span><span class="o">.</span>  <span class="n">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="o">.</span>


<span class="o">--------------------------------------------------------------</span>
<span class="n">C</span><span class="o">++</span> <span class="n">Compiler</span> <span class="n">version</span><span class="p">:</span>
<span class="n">mpiicpc</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">MPI</span> <span class="n">Library</span> <span class="mi">2018</span> <span class="n">Update</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">Linux</span><span class="o">*</span>
<span class="n">Copyright</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2003</span><span class="o">-</span><span class="mi">2018</span><span class="p">,</span> <span class="n">Intel</span> <span class="n">Corporation</span><span class="o">.</span>  <span class="n">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="o">.</span>
<span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">C</span><span class="o">++</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="mi">64</span> <span class="n">Compiler</span> <span class="k">for</span> <span class="n">applications</span> <span class="n">running</span> <span class="n">on</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="mi">64</span><span class="p">,</span> <span class="n">Version</span> <span class="mf">18.0</span><span class="o">.</span><span class="mf">5.274</span> <span class="n">Build</span> <span class="mi">20180823</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">1985</span><span class="o">-</span><span class="mi">2018</span> <span class="n">Intel</span> <span class="n">Corporation</span><span class="o">.</span>  <span class="n">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="o">.</span>


<span class="o">--------------------------------------------------------------</span>
<span class="n">Preprocessor</span> <span class="n">version</span><span class="p">:</span>
<span class="n">gcc</span> <span class="p">(</span><span class="n">GCC</span><span class="p">)</span> <span class="mf">4.8</span><span class="o">.</span><span class="mi">5</span> <span class="mi">20150623</span> <span class="p">(</span><span class="n">Red</span> <span class="n">Hat</span> <span class="mf">4.8</span><span class="o">.</span><span class="mi">5</span><span class="o">-</span><span class="mi">36</span><span class="p">)</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2015</span> <span class="n">Free</span> <span class="n">Software</span> <span class="n">Foundation</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">;</span> <span class="n">see</span> <span class="n">the</span> <span class="n">source</span> <span class="k">for</span> <span class="n">copying</span> <span class="n">conditions</span><span class="o">.</span>  <span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span>
<span class="n">warranty</span><span class="p">;</span> <span class="ow">not</span> <span class="n">even</span> <span class="k">for</span> <span class="n">MERCHANTABILITY</span> <span class="ow">or</span> <span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span><span class="o">.</span>


<span class="o">--------------------------------------------------------------</span>
 <span class="o">*</span> <span class="n">User</span> <span class="nb">set</span> <span class="n">ESMF</span> <span class="n">environment</span> <span class="n">variables</span> <span class="o">*</span>
<span class="n">ESMF_COMM</span><span class="o">=</span><span class="n">intelmpi</span>
<span class="n">ESMF_COMPILER</span><span class="o">=</span><span class="n">intel</span>
<span class="n">ESMF_DIR</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">planetary</span><span class="o">/</span><span class="n">esmf</span>
<span class="n">ESMF_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">shared</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">planetary</span><span class="o">/</span><span class="n">esmf</span>

<span class="o">--------------------------------------------------------------</span>
<span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
<p>At the end of compilation you should get:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>make[2]: Leaving directory `/gpfs20/shared/src/planetary/esmf&#39;
make[1]: Leaving directory `/gpfs20/shared/src/planetary/esmf&#39;
make[1]: Entering directory `/gpfs20/shared/src/planetary/esmf&#39;
make[1]: Nothing to be done for `build_tracelibs&#39;.
make[1]: Leaving directory `/gpfs20/shared/src/planetary/esmf&#39;
make[1]: Entering directory `/gpfs20/shared/src/planetary/esmf&#39;
make[1]: Leaving directory `/gpfs20/shared/src/planetary/esmf&#39;
ESMF library built successfully on Mon Apr 15 11:30:40 EDT 2019
To verify, build and run the unit and system tests with: make check
 or the more extensive: make all_tests
</pre></div>
</div>
<p>The tests can be performed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">all_tests</span>
</pre></div>
</div>
<p>After the tests you should see and output like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The stdout files for the examples can be found at:
/shared/src/planetary/esmf/examples/examplesO/Linux.intel.64.intelmpi.default

Found 85 multi-processor examples, 85 passed and 0 failed.

make[2]: Leaving directory `/gpfs20/shared/src/planetary/esmf&#39;

SYSTEM TESTS SUMMARY
Found 45 multi-processor system tests, 45 passed and 0 failed.

EXAMPLES SUMMARY
Found 85 multi-processor examples, 85 passed and 0 failed.

UNIT TESTS SUMMARY
Found 3460 non-exhaustive multi-processor unit tests, 3460 passed and 0 failed.

make[1]: Leaving directory `/gpfs20/shared/src/planetary/esmf&#39;
</pre></div>
</div>
</div>
<div class="section" id="installing-esmf">
<h3>Installing ESMF<a class="headerlink" href="#installing-esmf" title="Permalink to this headline">¶</a></h3>
<p>Finally, install the libraries and supporting binaries with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="thermosphere-ionosphere-electrodynamics-general-circulation-model-tie-gcm">
<h2>Thermosphere Ionosphere Electrodynamics General Circulation Model (TIE-GCM)<a class="headerlink" href="#thermosphere-ionosphere-electrodynamics-general-circulation-model-tie-gcm" title="Permalink to this headline">¶</a></h2>
<p>The NCAR Thermosphere-Ionosphere-Electrodynamics General Circulation Model (TIE-GCM) is a comprehensive, first-principles, three-dimensional, non-linear representation of the coupled thermosphere and ionosphere system that includes a self-consistent solution of the middle and low-latitude dynamo field. The model solves the three-dimensional momentum, energy and continuity equations for neutral and ion species at each time step, using a semi-implicit, fourth-order, centered finite difference scheme on each pressure surface in a staggered vertical grid. It can be run in either serial or parallel mode on a variety of platforms, including Linux workstations and supercomputers. The time step is typically 120 s.</p>
<div class="section" id="id1">
<h3>Download the code<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The code can be downloaded from <a class="reference external" href="https://www.hao.ucar.edu/modeling/tgcm/tie.php">HAO-UCAR webpage</a></p>
<p>After registering 3 files need to be downloaded for TIE-GCM 2.0:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tiegcm2</span><span class="o">.</span><span class="mf">0.</span><span class="n">tar</span>
<span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span><span class="n">_res2</span><span class="o">.</span><span class="mi">5</span><span class="n">_data</span><span class="o">.</span><span class="n">tar</span>
<span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span><span class="n">_res5</span><span class="o">.</span><span class="mi">0</span><span class="n">_data</span><span class="o">.</span><span class="n">tar</span>
</pre></div>
</div>
<p>The files can be uncompress with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">tiegcm2</span><span class="o">.</span><span class="mf">0.</span><span class="n">tar</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span><span class="n">_res2</span><span class="o">.</span><span class="mi">5</span><span class="n">_data</span><span class="o">.</span><span class="n">tar</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span><span class="n">_res5</span><span class="o">.</span><span class="mi">0</span><span class="n">_data</span><span class="o">.</span><span class="n">tar</span>
</pre></div>
</div>
</div>
<div class="section" id="editing-the-make-configuration">
<h3>Editing the make configuration<a class="headerlink" href="#editing-the-make-configuration" title="Permalink to this headline">¶</a></h3>
<p>Once you have downloaded and uncompress the files. You need to adapt/create a Make configuration file suitable for the cluster were the model will run.
Go to <code class="docutils literal notranslate"><span class="pre">tiegcm2.0/scripts</span></code> and make a copy of <code class="docutils literal notranslate"><span class="pre">Make.intel_hao64</span></code> as we will use it as template for our cluster. This tutorial assumes that you are using Thorny Flat, so copy the file as <code class="docutils literal notranslate"><span class="pre">Make.intel_thorny</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">scripts</span>
<span class="n">cp</span> <span class="n">Make</span><span class="o">.</span><span class="n">intel_hao64</span> <span class="n">Make</span><span class="o">.</span><span class="n">intel_thorny</span>
</pre></div>
</div>
<p>Modify <code class="docutils literal notranslate"><span class="pre">Make.intel_thorny</span></code> to match the file below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#
# Included makefile for Intel ifort compiler with openmpi on 64-bit HAO machines.
# Intel ifort (IFORT) 12.0.0 20101006
#
F90      = ifort
MPIF90   = mpiifort
MPIRUN   = mpirun -l -s all
FFLAGS   = -r8 -heap-arrays
DBGFLAGS = -debug full -traceback
DBGFLAGS += -check bounds -check format -check output_conversion -check pointers -check uninit
DBGFLAGS += -fpe-all=0 # this traps all floating point exceptions
#
# Makefile will use OPTIM = -g if set debug=TRUE in job script.
OPTIM    = -O3
LIBS     = -lcurl -lnetcdff -lnetcdf
HOST     = $(shell hostname)
#
# Library and Include file paths:
#
LIB_NETCDF = /shared/software/libs/netcdf/4.x_intel18_impi18/lib
INC_NETCDF = /shared/software/libs/netcdf/4.x_intel18_impi18/include
#
# This public release of ESMF was built at hao with intel on Dec 22, 2015:
#
LIB_ESMF = /shared/software/planetary/esmf/lib/libO/Linux.intel.64.intelmpi.default
#
# Make machines.ini file for MPI execution:
#
prereq: machines.ini mpirun.command
machines.ini: export HN=$(HOST)
machines.ini: export NP=$(NPROC)
machines.ini: FORCE
        @echo &quot;Making machines.ini..&quot;
        @echo `hostname` &gt; machines.ini
        @awk &#39;BEGIN{ for (i=2; i &lt;= ENVIRON[&quot;NP&quot;]; i++) print ENVIRON[&quot;HN&quot;] }&#39; &gt;&gt; machines.ini

mpirun.command: FORCE
        @echo &quot;Making mpirun.command: MPIRUN=$(MPIRUN)&quot;
        @echo $(MPIRUN) &gt; mpirun.command

FORCE:
</pre></div>
</div>
<p>Notice that we have change the compilers, as loading the module for Intel 2018 will add them to the search <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.
It is important to add <code class="docutils literal notranslate"><span class="pre">-lnetcdff</span> <span class="pre">-lnetcdf</span></code> as newer versions of NetCDF separate the fortran and C interfaces and both libraries need to be loaded.
You should also load the module for netcdf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">libs</span><span class="o">/</span><span class="n">netcdf</span><span class="o">/</span><span class="mf">4.</span><span class="n">x_intel18_impi18</span>
</pre></div>
</div>
<p>In the previous section we have compiled and installed ESMF. The location on Thorny Flat being <code class="docutils literal notranslate"><span class="pre">/shared/software/planetary/esmf</span></code> so the variable <code class="docutils literal notranslate"><span class="pre">LIB_ESMF</span></code> reflects the location for ESMF libraries.</p>
<p>This Make configuration file should remain in <code class="docutils literal notranslate"><span class="pre">tiegcm2.0/scripts</span></code> and will be captured by the execution script.</p>
</div>
<div class="section" id="editing-the-execution-script">
<h3>Editing the execution script<a class="headerlink" href="#editing-the-execution-script" title="Permalink to this headline">¶</a></h3>
<p>Now we have to edit the execution script <code class="docutils literal notranslate"><span class="pre">tiegcm-thorny.job</span></code>. It is a good idea to make a copy of it before editing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">tiegcm</span><span class="o">-</span><span class="n">linux</span><span class="o">.</span><span class="n">job</span> <span class="n">tiegcm</span><span class="o">-</span><span class="n">thorny</span><span class="o">.</span><span class="n">job</span>
</pre></div>
</div>
<p>There just a few changes to introduce here. The whole script will not be shown here, just the pieces that needs some changes. The first portion should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#! /bin/csh
#
# Job script to build and execute the model on a 64-bit Linux desktop machine.
#
# User must set shell variables below:
#
#   modeldir:  Root directory to model source (may be an SVN working dir)
#   execdir:   Directory in which to build and execute (will be created if necessary)
#   tgcmdata:  Directory in which startup history and data files are accessed.
#              (If tgcmdata is not set, the model will use env var TGCMDATA)
#   input:     Namelist input file for the chosen model resolution
#   output:    Stdout file from model execution (will be created)
#   modelres:  Model resolution (5.0 or 2.5 degrees)
#   make:      Build file with platform-specific compile parameters (in scripts dir)
#   mpi:       TRUE/FALSE for MPI run (non-MPI runs are not supported in v2.0 and later)
#   debug:     If TRUE, build and execute a &quot;debug&quot; run (debug compiler flags are set)
#   exec:      If TRUE, execute the model (build only if exec is FALSE)
#   utildir:   Directory containing supporting scripts (default $modeldir/scripts)
#   runscript: LSF script with run commands (submitted with bsub from execdir)
#
# To switch to 2.5-deg resolution, set modelres below to 2.5,
# and change execdir, tgcmdata and namelist input if necessary.
#
set modeldir = tiegcm2.0
set execdir  = tiegcm.exec
set tgcmdata = tiegcm_res2.5_data
set input    = tiegcm_res2.5.inp
set output   = tiegcm_res2.5.out
set modelres = 2.5
set make     = Make.intel_thorny
set mpi      = TRUE
set nproc    = 20
set debug    = FALSE
set exec     = TRUE
set utildir  = $modeldir/scripts
...
</pre></div>
</div>
<p>Notice that the make file changed to <code class="docutils literal notranslate"><span class="pre">Make.intel_thorny</span></code>. Next, the number of processors is fixed to 20, notice that on Thorny Flat we have nodes with 24 and 40. The best number depends on how intense in the calculation. For 5.0 degrees
the code completes in just a few minutes. Remember to change modelres accordingly: 5.0 or 2.5 degrees and related files.</p>
<p>The final change is half down the script were there is a conditional for using the intel compiler. Around line 210 I include a condition to set the compiler to intel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set compiler = &#39;unknown&#39;
if ($make == Make.intel_hao64) then
  set compiler = intel
else if ($make == Make.pgi_hao64) then
  set compiler = pgi
else if ($make == Make.gfort_hao64) then
  set compiler = gfort
else if ($make == Make.intel_thorny) then
  set compiler = intel
endif
echo Compiler: $compiler
</pre></div>
</div>
<p>Using 20 cores, it takes around 7 minutes on Thorny Flat to get the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Executing</span> <span class="n">mpirun</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">s</span> <span class="nb">all</span> <span class="k">with</span> <span class="n">executable</span> <span class="o">./</span><span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span> <span class="n">at</span> <span class="n">Tue</span> <span class="n">Apr</span> <span class="mi">16</span> <span class="mi">10</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">11</span> <span class="n">EDT</span> <span class="mi">2019</span>
<span class="n">Linux</span> <span class="n">MPI</span> <span class="n">run</span> <span class="n">of</span> <span class="o">./</span><span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span> <span class="n">completed</span> <span class="n">at</span> <span class="n">Tue</span> <span class="n">Apr</span> <span class="mi">16</span> <span class="mi">10</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">45</span> <span class="n">EDT</span> <span class="mi">2019</span>
<span class="n">Overwriting</span> <span class="n">file</span>  <span class="o">/</span><span class="n">gpfs20</span><span class="o">/</span><span class="n">shared</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">planetary</span><span class="o">/</span><span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tiegcm_res2</span><span class="o">.</span><span class="mf">5.</span><span class="n">out</span>  <span class="k">with</span> <span class="n">non</span><span class="o">-</span><span class="n">ASCII</span> <span class="n">characters</span> <span class="n">removed</span><span class="o">.</span>
<span class="n">mklogs</span><span class="p">:</span> <span class="n">Extracting</span> <span class="n">log</span> <span class="n">files</span> <span class="kn">from</span>  <span class="o">/</span><span class="n">gpfs20</span><span class="o">/</span><span class="n">shared</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">planetary</span><span class="o">/</span><span class="n">tiegcm2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tiegcm_res2</span><span class="o">.</span><span class="mf">5.</span><span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-global-ionosphere-thermosphere-model-gitm">
<h2>The Global Ionosphere/Thermosphere Model (GITM)<a class="headerlink" href="#the-global-ionosphere-thermosphere-model-gitm" title="Permalink to this headline">¶</a></h2>
<p>GITM is a 3-dimensional spherical code that models the Earth’s thermosphere and ionosphere system using a stretched grid in latitude and altitude. The number of grid points in each direction can be specified, so the resolution is extremely flexible. GITM explicitly solves for the neutral densities of O, O2, N(2D), N(2P), N(4S), N2, and NO; and ion species O+(4S), O+(2D), O+(2P), O2+, N+, N2+, and NO+. One major difference between GITM and other thermosphere codes is the use of an altitude grid instead of a pressure grid. The vertical grid spacing is less than 3 km in the lower thermosphere, and over 10 km in the upper thermosphere. GITM allows for non-hydrostatic solutions to develop (i.e., the full vertical momentum equation is solved), so more realistic dynamics in the auroral zone can be simulated.</p>
<p>The procedure to compile the code is not properly documented, so instructions here are specific for our clusters, in particular Thorny Flat.</p>
<div class="section" id="cloning-the-repository">
<h3>Cloning the repository<a class="headerlink" href="#cloning-the-repository" title="Permalink to this headline">¶</a></h3>
<p>The package can be cloned from the Github page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">aaronjridley</span><span class="o">/</span><span class="n">GITM</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-build">
<h3>Configuring the build<a class="headerlink" href="#configuring-the-build" title="Permalink to this headline">¶</a></h3>
<p>The build system is managed by a Perl script located on the root folder <code class="docutils literal notranslate"><span class="pre">Config.pl</span></code>. All documentation about building this code is provided by executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">Config</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>We will compile the code on Thonry Flat with support for MPI and HDF5, the modules to load are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">lang</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">2018</span><span class="n">_u4</span> <span class="n">libs</span><span class="o">/</span><span class="n">hdf5</span><span class="o">/</span><span class="mf">1.10</span><span class="o">.</span><span class="mi">5</span><span class="n">_intel18_impi18</span>
</pre></div>
</div>
<p>To configure the build for Intel compilers and support  for Parallel HDF5 execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">Config</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">install</span> <span class="o">-</span><span class="n">compiler</span><span class="o">=</span><span class="n">mpiifort</span><span class="p">,</span><span class="n">icc</span> <span class="o">-</span><span class="n">hdf5</span>
</pre></div>
</div>
<p>The command should produce an output like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Installing GITM2
touch Library/src/Makefile.DEPEND Library/src/Makefile.RULES
cp src/ModSize.f90.orig src/ModSize.f90
touch src/Makefile.DEPEND src/Makefile.RULES srcInterface/Makefile.DEPEND
Enabling HDF5 library in Makefile.conf
set_hdf5_: cp share/Library/src/ModHdf5Utils_orig.f90 share/Library/src/ModHdf5Utils.f90
set_spice_: cp share/Library/src/ModSpice_empty.f90 share/Library/src/ModSpice.f90
Configuring GITM for Earth!!
</pre></div>
</div>
<p>Any attempt to recompile with different settings usually requires removing all the sources and clone the repository back, several pieces of code remain even executing <code class="docutils literal notranslate"><span class="pre">./Config.pl</span> <span class="pre">-uninstall</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>. This is particularly true if you change compiler.</p>
</div>
<div class="section" id="building-the-code">
<h3>Building the code<a class="headerlink" href="#building-the-code" title="Permalink to this headline">¶</a></h3>
<p>After configuration several make configuration files are copied to the root folder of GITM and the code is ready for compilation. Execute the configure script again to confirm yours settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./Config.pl

GITM2 is installed in directory /gpfs20/shared/src/planetary/aaronjridley/GITM
    as a stand-alone code.
The installation is for the Linux operating system.
Makefile.conf was created from share/build/Makefile.Linux.mpiifort
                           and share/build/Makefile.icc
The selected F90 compiler is ifort.
The selected C   compiler is icc.
The default precision for reals is double precision.
The maximum optimization level is -O4
Debugging flags:   no
Linked with MPI:   yes
Linked with HDF5:  yes
Linked with HYPRE: no
Linked with FISHPAK: no
Linked with SPICE: no
Number of cells in a block: nLon=9, nLat=9, nAlt=50
Max. number of blocks     : MaxBlock=4
Planet=Earth
</pre></div>
</div>
<p>Execute make to compile the code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>The binary <code class="docutils literal notranslate"><span class="pre">GITM.exe</span></code> will be located at <code class="docutils literal notranslate"><span class="pre">src</span></code> folder.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="79.NAMD.html" class="btn btn-neutral float-right" title="NAMD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="77.Visit.html" class="btn btn-neutral float-left" title="Visualization: VisIt" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, West Virginia University

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>