

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tinker9 &mdash; WVU-RC 2023.02.20 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cuda" href="616.Cuda.html" />
    <link rel="prev" title="Building Julia" href="614.Julia.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WVU-RC
          

          
            
            <img src="../_static/ResearchComputing.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2023.02
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="10.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="20.QuickStart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="30.BasicUsage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="40.AdvancedUsage.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="500.ScientificProgramming.html">Scientific Programming</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="600.SoftAdmin.html">Software Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="601.SphinxDocs.html">Editing these documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="602.UserInstallation.html">Installing Packages in User Locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="603.LinearAlgebra.html">Linear Algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="604.Boost.html">Boost 1.79</a></li>
<li class="toctree-l2"><a class="reference internal" href="605.MPI.html">Message Passing Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="606.HDF5_NetCDF.html">HDF5 and NetCDF</a></li>
<li class="toctree-l2"><a class="reference internal" href="607.FFT.html">Fast Fourier Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="608.ForceFields.html">Force Field Molecular Dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="609.CHARM%2B%2B_NAMD.html">CHARM++ and NAMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="610.DFT.html">Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="611.BigData.html">Big Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="612.Python.html">Python 3.9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="613.Matlab_MMX.html">Matlab N-D multithreaded matrix operations (MMX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="614.Julia.html">Building Julia</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tinker9</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clone-the-repository">Clone the repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-build-folder">Create a build folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modules-for-compilation">Modules for compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-tinker9">Configuring tinker9</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-tests">Running the tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="616.Cuda.html">Cuda</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="70.DomainSpecific.html">Domain Specific Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="80.ClusterSpecific.html">Clusters Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="90.References.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WVU-RC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="600.SoftAdmin.html">Software Administration</a> &raquo;</li>
        
      <li>Tinker9</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/text/615.Tinker9.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="tinker9">
<h1>Tinker9<a class="headerlink" href="#tinker9" title="Permalink to this headline">¶</a></h1>
<p>The Tinker molecular modeling software is a complete and general package for molecular mechanics and dynamics, with some special features for biopolymers. Tinker has the ability to use any of several common parameter sets, such as Amber (ff94, ff96, ff98, ff99, ff99SB), CHARMM (19, 22, 22/CMAP), Allinger MM (MM2-1991 and MM3-2000), OPLS (OPLS-UA, OPLS-AA), Merck Molecular Force Field (MMFF), Liam Dang’s polarizable model, AMOEBA (2004, 2009, 2013, 2017, 2018) polarizable atomic multipole force fields, AMOEBA+ that adds charge penetration effects, and our new HIPPO (Hydrogen-like Interatomic Polarizable POtential) force field. Parameter sets for other force field models are under consideration for future releases.</p>
<p>Tinker9 is a complete rewrite and extension of the canonical Tinker software, currently Tinker8. Tinker9 is implemented as C++ code with OpenACC directives and CUDA kernels providing excellent performance on GPUs. At present, Tinker9 builds against the object library from Tinker8, and provides GPU versions of the Tinker ANALYZE, BAR, DYNAMIC, MINIMIZE and TESTGRAD programs. Existing Tinker file formats and force field parameter files are fully compatible with Tinker9, and nearly all Tinker8 keywords function identically in Tinker9. Over time we plan to port much or all of the remaining portions of Fortran Tinker8 to the C++ Tinker9 code base.</p>
<p>These instructions describe how tinker9 was compiled on Thorny Flat with GPU support for the particular GPU cards present on this cluster.</p>
<section id="clone-the-repository">
<h2>Clone the repository<a class="headerlink" href="#clone-the-repository" title="Permalink to this headline">¶</a></h2>
<p>Tinker9 sources are on Github and uses submodules. This command will download the latest version and the submodules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; git clone --recurse-submodules https://github.com/TinkerTools/tinker9.git
</pre></div>
</div>
</section>
<section id="create-a-build-folder">
<h2>Create a build folder<a class="headerlink" href="#create-a-build-folder" title="Permalink to this headline">¶</a></h2>
<p>It is a best practice to use a separate build folder to compile the code. The sources remain untouched and it is easy to just remove the content of the folder and recompile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; cd tinker9
$&gt; mkdir build
$&gt; cd build
</pre></div>
</div>
</section>
<section id="modules-for-compilation">
<h2>Modules for compilation<a class="headerlink" href="#modules-for-compilation" title="Permalink to this headline">¶</a></h2>
<p>Tinker9 uses cmake for building the software.
The version of cmake on RHEL 7.x is usually too old so it is a good idea to load a more recent version.
RHEL 7.x comes with cmake version 2.8.12.2 and the CMakeLists request the minimal version being 3.12.</p>
<p>Tinker9 is implemented as C++ and takes advantage of GPUs via OpenACC directives and CUDA programming.
The natural compiler for a code that uses OpenACC is NVIDIA HPC suite as OpenACC is better implemented.
For the CUDA side the latest version of the CUDA Toolkit at the time of writing this (April 2022) is CUDA 11.5.
These are the modules loaded for compiling tinker9:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module load dev/cmake/3.21.1 dev/git/2.29.1 lang/nvidia/nvhpc/21.11 parallel/cuda/11.5
</pre></div>
</div>
</section>
<section id="configuring-tinker9">
<h2>Configuring tinker9<a class="headerlink" href="#configuring-tinker9" title="Permalink to this headline">¶</a></h2>
<p>Configuring a code with cmake will prepare the sources, and create the Makefiles for building the binaries using the compilers and libraries declared with the arguments presented to cmake.
The cmake line used was this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; cmake -DCUDA_DIR=${CUDA_HOME} -DCOMPUTE_CAPABILITY=61,75,80 \
-DCMAKE_Fortran_COMPILER=gfortran -DCMAKE_BUILD_TYPE=release \
-DCMAKE_INSTALL_PREFIX=/shared/software/atomistic/tinker9 \
-DCMAKE_CUDA_COMPILER=`which nvcc` -Wno-dev ..
</pre></div>
</div>
<p>The CUDA compute capabilities can be found on  <a class="reference external" href="https://developer.nvidia.com/cuda-gpus">CUDA Website</a>
For the particular case of Thorny Flat, we have 3 kinds of GPUs: P6000, RTX6000, and A100.
The compute capabilities for these cards are:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>GPU Model</p></th>
<th class="head"><p>Compute Capability</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Quadro P6000</p></td>
<td><p>61</p></td>
</tr>
<tr class="row-odd"><td><p>Quadro RTX 6000</p></td>
<td><p>75</p></td>
</tr>
<tr class="row-even"><td><p>NVIDIA A100</p></td>
<td><p>80</p></td>
</tr>
</tbody>
</table>
<p>After configuring the code execute make with a reasonable number of compilation threads. On the head node of Thorny Flat we have 24 cores, using 12 compilation threads is reasonable and the code will compile relatively fast:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; make -j12
</pre></div>
</div>
</section>
<section id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this headline">¶</a></h2>
<p>To run the tests lauch and interactive job on a queue allowing GPUs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; qsub -I -l nodes=1:ppn=16:gpus=2 -q be_gpu
</pre></div>
</div>
<p>Go to the build folder and check the GPU present on the node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; cd /shared/src/tinker9/build
$&gt; nvidia-smi
Fri Apr  1 12:35:39 2022
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 495.29.05    Driver Version: 495.29.05    CUDA Version: 11.5     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Quadro RTX 6000     Off  | 00000000:C1:00.0 Off |                    0 |
| N/A   25C    P8    14W / 250W |      0MiB / 22698MiB |      0%   E. Process |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
|   1  Quadro RTX 6000     Off  | 00000000:C2:00.0 Off |                    0 |
| N/A   25C    P8    15W / 250W |      0MiB / 22698MiB |      0%   E. Process |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
</pre></div>
</div>
<p>Load the modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module load dev/cmake/3.21.1 dev/git/2.29.1 lang/nvidia/nvhpc/21.11 parallel/cuda/11.5
</pre></div>
</div>
<p>Execute the test suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    $&gt; make test
    [ 69%] Built target tinkerObjF
    [ 69%] Built target tinkerObjCpp
    [ 69%] Built target tinkerFToCpp
    [ 83%] Built target tinker9_cpp
    [ 88%] Built target __t9_all_tests_o
    [ 89%] Built target tinker9_f
    [ 89%] Built target tinker9_version
    [ 97%] Built target tinker9_acc
    [100%] Built target tinker9_cu
    [100%] Built target all.tests
    Filters: info
     Primary GPU package :  CUDA

     GPU Device :  Setting Device ID to 0 from GPU utilization


     Program Information

            Version:                             1.0.0 GIT 1e34a417
            Synchronized with Tinker commit:     5aa9948d
            C++ compiler:                        nvc++ 21.11.0
            Size of real (bytes):                4
            Size of mixed (bytes):               8
            Using deterministic force:           true
            Debug mode:                          off
            Platform:                            CUDA and OpenACC
            Primary GPU package:                 CUDA
            Latest CUDA supported by driver:     11.5
            CUDA runtime version:                11.5
            Thrust version:                      1.13.1 patch 0
            CUDA compiler:                       nvcc 11.5.119
            OpenACC compiler:                    nvc++ 21.11.0
            GPU detected:                        2
            GPU 0:
               PCI:                              0000:C1:00.0
               Name:                             Quadro RTX 6000
               Maximum compute capability:       7.5
               Single double perf. ratio:        32
               Compute mode:                     exclusive process
               Error-correcting code (ECC):      on
               Clock rate (kHz):                 1620000
               Number of Multiprocessors:        72
               Number of CUDA cores:             9216
               Used/Total GPU memory:            0.79 % / 22.17 GB
            GPU 1:
               PCI:                              0000:C2:00.0
               Name:                             Quadro RTX 6000
               Maximum compute capability:       7.5
               Single double perf. ratio:        32
               Compute mode:                     exclusive process
               Error-correcting code (ECC):      on
               Clock rate (kHz):                 1620000
               Number of Multiprocessors:        72
               Number of CUDA cores:             9216
               Used/Total GPU memory:            0.79 % / 22.17 GB
    ===============================================================================
    test cases: 1 | 1 passed
    assertions: - none -

    Filters: [ff],[util]

.....######################################################################
...##########################################################################
..###                                                                      ###
.###            Tinker9  --  Software Tools for Molecular Design            ###
.##                                                                          ##
.##                      Version 1.0.0-rc  January 2021                      ##
.##                                                                          ##
.##                 Copyright (c)  Zhi Wang &amp; the Ponder Lab                 ##
.###                           All Rights Reserved                          ###
..###                                                                      ###
...##########################################################################
.....######################################################################

     Compiled at:  12:18:38  Apr  1 2022
     Commit Date:  Fri Apr 1 04:23:24 2022 -0500
     Commit:       1e34a417

     Primary GPU package :  CUDA

     GPU Device :  Setting Device ID to 0 from GPU utilization

    ...
    ...
    ...

    ===============================================================================
    All tests passed (65640 assertions in 58 test cases)

    [100%] Built target test
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="616.Cuda.html" class="btn btn-neutral float-right" title="Cuda" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="614.Julia.html" class="btn btn-neutral float-left" title="Building Julia" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, West Virginia University

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>