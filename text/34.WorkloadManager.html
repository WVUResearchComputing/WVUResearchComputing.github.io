

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Workload Manager (SLURM) &mdash; WVU-RC 2023.10.11 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File Transfer (Globus and SFTP)" href="35.TransferFiles.html" />
    <link rel="prev" title="Environment Modules" href="33.EnvModules.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WVU-RC
          

          
            
            <img src="../_static/ResearchComputing.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2023.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="10.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="20.QuickStart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="30.BasicUsage.html">Basic Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="31.TextEditors.html">Terminal-based Text Editors</a></li>
<li class="toctree-l2"><a class="reference internal" href="32.DataStorage.html">Data Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="33.EnvModules.html">Environment Modules</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Workload Manager (SLURM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understanding-partitions">Understanding Partitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#submitting-batch-jobs">Submitting batch jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monitoring-jobs">Monitoring jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#canceling-a-job">Canceling a job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#estimation-of-the-starting-time-for-a-job">Estimation of the starting time for a job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detailed-information-about-jobs">Detailed information about jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#controling-the-limit-of-time-for-a-job">Controling the limit of time for a job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#specifying-number-of-nodes-tasks-and-cpu-cores">Specifying number of Nodes, tasks and CPU Cores</a></li>
<li class="toctree-l3"><a class="reference internal" href="#translating-pbs-scripts-to-slurm-scripts">Translating PBS Scripts to Slurm Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#old-documentation">OLD DOCUMENTATION</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#resource-specification">Resource Specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#e-mail-options">E-mail options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-file-specification">Output file specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requesting-array-jobs">Requesting Array jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interactive-jobs">Interactive Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphical-interface-jobs">Graphical Interface Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-the-status-of-jobs">Checking the Status of Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#canceling-removing-a-job">Canceling/Removing a Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-prologue-and-epilogue-scripts-to-a-job">Adding Prologue and Epilogue scripts to a Job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-of-prologue">Example of Prologue</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-of-epilogue">Example of Epilogue</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#samples-of-job-submission-scripts">Samples of Job Submission scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#script-for-running-a-non-array-batch-queue">Script for running a non-array batch queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="#script-for-running-an-array-batch-queue">Script for running an array batch queue</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="35.TransferFiles.html">File Transfer (Globus and SFTP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="36.WebInterface.html">Web Interface (Open On-Demand)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="40.AdvancedUsage.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="500.ScientificProgramming.html">Scientific Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="600.SoftAdmin.html">Software Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="700.DomainSpecific.html">Domain Specific Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="80.ClusterSpecific.html">Clusters Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="90.References.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WVU-RC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="30.BasicUsage.html">Basic Usage</a> &raquo;</li>
        
      <li>Workload Manager (SLURM)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/text/34.WorkloadManager.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="workload-manager-slurm">
<span id="bs-workload-manager"></span><h1>Workload Manager (SLURM)<a class="headerlink" href="#workload-manager-slurm" title="Permalink to this headline">¶</a></h1>
<p>A workload manager is a piece of software that transforms a set of networked computers into a HPC cluster.
The workload manager has several responsibilites: Resource Manager and Scheduler.
In the case of SLURM both tasks are assumeb by the same piece of software.
Is the workload manager what makes an HPC cluster to look like a supercomputer rather than a set of independent machines on a datacenter.</p>
<p>Resource manager has several subtasks associated with it.
From one side, it keeps track of the resources present in the cluster and the availability on a given point in time.
Individual computers could be added or removed from the pool of resources. Their load is recorded periodically to determine the feasibility of executing more jobs.
It also keeps records for accounting purposes or profiling.</p>
<p>The scheduler side of a workload manager takes care of the jobs submitted to the cluster.
Process the list of resources requested for each job and priorizes the execution according to some criteria or constrains imposed on the job or the current state of the cluster.</p>
<p>In this section we will cover in more detail the commands, variables and directives used by SLURM to help users to submit, monitor and control the jobs on the cluster.
The configuration and administration of SLURM is out of scope for this section.</p>
<section id="understanding-partitions">
<h2>Understanding Partitions<a class="headerlink" href="#understanding-partitions" title="Permalink to this headline">¶</a></h2>
<p>The compute nodes on an HPC cluster are logically segmented into partitions.
A partition is just a list of compute nodes where jobs submitted to it can execute.
A compute node could belong to several partitions.
A partition also include rules that must be followed before a job can be admitted and rules that declare how jobs will run on the cluster and conditions on when and how jobs can start execution.</p>
<p>All jobs regardless of if they are batch jobs or interactive jobs they are always submitted to some partition.
To know the list of partitions on the cluster execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sinfo -s
PARTITION       AVAIL  TIMELIMIT   NODES(A/I/O/T) NODELIST
standby*           up    4:00:00      88/77/2/167 taicm[001-009],tarcl100,
                                              tarcs[100,200-206,300-304],tbdcx001,
                                              tbmcs[001-011,100-103],tbpcm200,tbpcs001,
                                              tcbcx100,tcdcx100,tcgcx300,tcocm[100-104],
                                              tcocs[001-064,100],tcocx[001-003],tcscm300,
                                              tjscl100,tjscm001,tmmcm[100-108],tngcm200,
                                              tpmcm[001-006],tsacs001,tsdcl[001-002],
                                              tsscl[001-002],ttmcm[100-101],tzecl[100-107],
                                              tzecs[100-115]
comm_small_day     up 1-00:00:00        64/0/1/65 tcocs[001-064,100]
comm_small_week    up 7-00:00:00        64/0/1/65 tcocs[001-064,100]
comm_med_day       up 1-00:00:00          4/1/0/5 tcocm[100-104]
comm_med_week      up 7-00:00:00          4/1/0/5 tcocm[100-104]
comm_xl_week       up 7-00:00:00          0/3/0/3 tcocx[001-003]
comm_gpu_inter     up    4:00:00         5/6/0/11 tbegq[200-202],tbmgq[001,100],tcogq[001-006]
comm_gpu_week      up 7-00:00:00          1/5/0/6 tcogq[001-006]
aei0001            up   infinite          2/6/1/9 taicm[001-009]
alromero           up   infinite        14/0/0/14 tarcl100,tarcs[100,200-206,300-304]
be_gpu             up   infinite          2/1/0/3 tbegq[200-202]
bvpopp             up   infinite          0/1/0/1 tbpcs001
cedumitrescu       up   infinite          0/1/0/1 tcdcx100
cfb0001            up   infinite          0/1/0/1 tcbcx100
cgriffin           up   infinite          1/0/0/1 tcgcx300
chemdept           up   infinite          0/4/0/4 tbmcs[100-103]
chemdept-gpu       up   infinite          1/0/0/1 tbmgq100
cs00048            up   infinite          0/1/0/1 tcscm300
jaspeir            up   infinite          0/2/0/2 tjscl100,tjscm001
jbmertz            up   infinite        3/14/0/17 tbmcs[001-011,100-103],tbmgq[001,100]
mamclaughlin       up   infinite          0/9/0/9 tmmcm[100-108]
ngarapat           up   infinite          0/1/0/1 tngcm200
pmm0026            up   infinite          0/6/0/6 tpmcm[001-006]
sbs0016            up   infinite          0/2/0/2 tsscl[001-002]
spdifazio          up   infinite          0/2/0/2 tsdcl[001-002]
tdmusho            up   infinite          0/2/0/2 ttmcm[100-101]
vyakkerman         up   infinite          0/1/0/1 tsacs001
zbetienne          up   infinite        1/23/0/24 tzecl[100-107],tzecs[100-115]
zbetienne_large    up   infinite          0/8/0/8 tzecl[100-107]
zbetienne_small    up   infinite        1/15/0/16 tzecs[100-115]
</pre></div>
</div>
<p>The first column is the name of the partition. The star (*) after <code class="docutils literal notranslate"><span class="pre">default</span></code> indicates that this will be the selected partition if not specified during the submission of the job either via command line arguments or submission directives in the submission file. All the partitions starting with <code class="docutils literal notranslate"><span class="pre">comm_</span></code> are community partitions, meaning that anyone with an user account can submit on them. Faculty can purchase compute nodes that will receive its own partition with no limits on the amount of time the job can run on their own partition.
Community queues use a name schema that makes easy to identify its specifications.</p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">User Commands</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Word</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">_small</span></code></p></td>
<td><p>Compute nodes associated to the partition offer 96GB of RAM</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">_med</span></code></p></td>
<td><p>Compute nodes associated to the partition offer 192GB of RAM</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">_xl</span></code></p></td>
<td><p>Compute nodes associated to the partition offer 768GB of RAM</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">_gpu</span></code></p></td>
<td><p>Compute nodes associated to the partition include GPU cards</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">_day</span></code></p></td>
<td><p>The partition has a walltime of maximum 1 day</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">_week</span></code></p></td>
<td><p>The partition has a walltime of maximum 1 week</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">comm_gpu_inter</span></code></p></td>
<td><p>Partition for interactive jobs with GPUs. The walltime is 4 hours</p></td>
</tr>
</tbody>
</table>
<p>The second column is the availability of the partition. At this point all partitions are enable and that is indicated with the word <code class="docutils literal notranslate"><span class="pre">up</span></code>.</p>
<p>The third column is the amount of time a job submitted to that partition can run, this is also known as the <strong>walltime</strong>.
Jobs submitted without any limit of time explicitly indicated will received the walltime of the partition.
Jobs that declare a larger walltime than the maximum allowed by the partition will be rejected inmediately after submission.</p>
<p>The fourth column provides a summary of the condition of nodes associated to the partition. The format is indicated as (A/I/O/T) and means (allocated/idle/other/total).
Allocated are nodes executing one or more jobs. Idle are compute nodes currently inactive but enable to execute jobs.
Other include nodes that are not allowed to execute jobs, due to maintnance or some other condition.
The sum of all these 3 states is the total number of compute nodes associated with the partition.</p>
<p>The fifth column is the nodelist. This is a compacted listing of all the machines associated with each partition.
The compact form is particularly useful in large HPC clusters with hundreds of compute nodes.
Notice for example that compute nodes <code class="docutils literal notranslate"><span class="pre">tcocs[001-064,100]</span></code> appear as nodes associated to <code class="docutils literal notranslate"><span class="pre">standby</span></code>, <code class="docutils literal notranslate"><span class="pre">comm_small_day</span></code> and <code class="docutils literal notranslate"><span class="pre">comm_small_week</span></code>.</p>
</section>
<section id="submitting-batch-jobs">
<h2>Submitting batch jobs<a class="headerlink" href="#submitting-batch-jobs" title="Permalink to this headline">¶</a></h2>
<p>A batch job is a job that has not expectations of running inmediately and will not be interactively operated when start running.
This is the kind of jobs an HPC cluster is preferentially built for.
You simply write on a text file the list of resources you need for the job and the list of steps to execute in the form of script and the job will be put in execution when resources became available.
The text file is called a <strong>submission script</strong> and it has two roles.
From one side, it has the script that will be put in execution on the compute node associated to the job.
From the other side, it has a set of lines starting with <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code>.
Those lines start with <code class="docutils literal notranslate"><span class="pre">#</span></code> meaning that they are ignored by the shell when running the script.
Those lines are important for SLURM as it will interpret those lines and compile a list of requirements and configurations associated to the job.
The lines starting with  <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> will not interpret shell variables or environment variables.
These lines will contain resource requests such as the number of compute nodes, number of CPU cores, memory requested, partition.
They also could contain the name of the job, specification for sending emails when the job start, ends of fails, where the output of the script wil go.
These lines could also include other configurations that will be used before, during and after the job enters in execution.</p>
<p>Our first example will be very simple.
Consider a submission script for a job called <strong>PI</strong>.
The job will compute the value of pi using the the arbitrary precision calculator bc.
The command to be executed will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo $(echo &quot;scale=65; 4*a(1)&quot; | bc -l)
</pre></div>
</div>
<p>This is a simple execution that takes a fraction of a second on any modern computer.
However, our purpose here is to use it to demonstrate how to submit a job that will be executed on a compute node.
In practical cases the execution will require several hours or even days and need multiple CPU cores or multiple compute nodes.
The submission script could be written like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

#SBATCH -J PI
#SBATCH -N 1
#SBATCH -c 1
#SBATCH -n 1
#SBATCH -p standby
#SBATCH -t 4:00:00

echo &quot;The first 65 digits of PI are:&quot;
echo $(echo &quot;scale=65; 4*a(1)&quot; | bc -l)

echo &quot;&quot;
echo &quot;Job ID:              $SLURM_JOB_ID&quot;
echo &quot;Job Name:            $SLURM_JOB_NAME&quot;
echo &quot;Number of Nodes:     $SLURM_JOB_NUM_NODES&quot;
echo &quot;Number of CPU cores: $SLURM_CPUS_ON_NODE&quot;
echo &quot;Number of Tasks:     $SLURM_NTASKS&quot;
echo &quot;Partition:           $SLURM_JOB_PARTITION&quot;
</pre></div>
</div>
<p>Assuming that this text is written on a file called <code class="docutils literal notranslate"><span class="pre">runjob.pbs</span></code>. Submit the job using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ sbatch runjob.pbs
</pre></div>
</div>
<p>The job will most likely execute after a few seconds. A file with a name such as <code class="docutils literal notranslate"><span class="pre">slurm-&lt;jobid&gt;.out</span></code> is created.
For example, if the job ID were 122014. The output produce by the submission script will contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ cat slurm-122014.out
The first 65 digits of PI are:
3.14159265358979323846264338327950288419716939937510582097494459228

Job ID:              122014
Job Name:            PI
Number of Nodes:     1
Number of CPU cores: 1
Number of Tasks:     1
Partition:           standby
</pre></div>
</div>
<p>Let us now understand the lines present on this first submission script.
The first line is called a <a class="reference external" href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a>
This is used to indicate which interpreter will be used for the lines on the script.
In this case we are saying that <code class="docutils literal notranslate"><span class="pre">bash</span></code> which is a commom shell interpreter must be used for the script.</p>
<p>The next 6 lines all start with <code class="docutils literal notranslate"><span class="pre">$SBATCH</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH -J PI</span>
<span class="c1">#SBATCH -N 1</span>
<span class="c1">#SBATCH -c 1</span>
<span class="c1">#SBATCH -n 1</span>
<span class="c1">#SBATCH -p standby</span>
<span class="c1">#SBATCH -t 4:00:00</span>
</pre></div>
</div>
<p>The lines will each in order, set the name of the job (-J), the number of compute nodes (-N), the number of CPU cores per task (-c), the number of tasks (-n), the partition selected for the job (-p) and the limit of time for the job (-t).
Except for the job name which is undefined by default, all other values here correspont to the default values.
The job name is optional and the other 5 lines can be removed from the submission script and the script will take assume the default values.
For this simple case all that result being one: One node, one task, one cpu per task and one cpu per node.
The concepts nodes, tasks and cpus per task or node will be covered below.</p>
<p>The next 2 lines are the actual execution that we want takes place on a compute node.
It could be a complex numerical simulation, solve a complex optimization problem, a genomic alignment.
Any computationally demanding operation will be here.</p>
<p>In the final 6 lines we are demonstrating the used of some Environment variables that are created when the job start running on the compute node.
In this case we are revelaling the content of those variables and writing those along with the output of the script.
These variables can be use in the script to change the execution lines according to their values.
More SLURM environment variables will be described below.</p>
<p>The output is all that the script or the programs call by the script writes produces to be seen on the screen.
If the script were executed directly, the standard output is the terminal window.
In the case of a batch script, all the output is directed to a couple of files.
The normal output also called standard output is written to a file that by default looks like <code class="docutils literal notranslate"><span class="pre">slurm-&lt;jobid&gt;.out</span></code>
The error output, text that is considered could be aside to the normal output is called standard error and it is sent to a separate file.
In our case we do not have any error and no error file is generated.</p>
<p>All the <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> directives are optional and there are default values for many of them or no value at all if not declared.
Consider for example the same submission script removing all the lines starting with <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

echo &quot;The first 65 digits of PI are:&quot;
echo $(echo &quot;scale=65; 4*a(1)&quot; | bc -l)

echo &quot;&quot;
echo &quot;Job ID:              $SLURM_JOB_ID&quot;
echo &quot;Job Name:            $SLURM_JOB_NAME&quot;
echo &quot;Number of Nodes:     $SLURM_JOB_NUM_NODES&quot;
echo &quot;Number of CPU cores: $SLURM_CPUS_ON_NODE&quot;
echo &quot;Number of Tasks:     $SLURM_NTASKS&quot;
echo &quot;Partition:           $SLURM_JOB_PARTITION&quot;
</pre></div>
</div>
<p>Producing a similar result in the output file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ cat slurm-122439.out
The first 65 digits of PI are:
3.14159265358979323846264338327950288419716939937510582097494459228

Job ID:              122439
Job Name:            runjob2.slurm
Number of Nodes:     1
Number of CPU cores: 1
Number of Tasks:
Partition:           standby
</pre></div>
</div>
<p>Notice that if the job has no name, the name of the submission script becomes its name.
One single node will be use and one single CPU core assigned to the job.
No declaring a number of tasks will create a job with no value for that.</p>
<p>We will explore more complex submission scripts and the meaning of the multiple options associated but first lets explore how to monitor the jobs submitted and how to cancel jobs.</p>
</section>
<section id="monitoring-jobs">
<h2>Monitoring jobs<a class="headerlink" href="#monitoring-jobs" title="Permalink to this headline">¶</a></h2>
<p>Lets consider a variation of the submission script were we will be asking for several many compute nodes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

#SBATCH -J PI
#SBATCH -N 80
#SBATCH -c 40
#SBATCH -n 80
#SBATCH -p standby
#SBATCH -t 4:00:00

echo &quot;The first 65 digits of PI are:&quot;
echo $(echo &quot;scale=65; 4*a(1)&quot; | bc -l)

echo &quot;&quot;
echo &quot;Job ID:              $SLURM_JOB_ID&quot;
echo &quot;Job Name:            $SLURM_JOB_NAME&quot;
echo &quot;Number of Nodes:     $SLURM_JOB_NUM_NODES&quot;
echo &quot;Number of CPU cores: $SLURM_CPUS_ON_NODE&quot;
echo &quot;Number of Tasks:     $SLURM_NTASKS&quot;
echo &quot;Partition:           $SLURM_JOB_PARTITION&quot;
</pre></div>
</div>
<p>Asumming this submission script was written on a file called <code class="docutils literal notranslate"><span class="pre">runjob_80n.slurm</span></code>, submit the job with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ sbatch runjob_40n.slurm
Submitted batch job 122837
</pre></div>
</div>
<p>This time no output in the form of the file <code class="docutils literal notranslate"><span class="pre">slurm-&lt;jobis&gt;.out</span></code>
Check the status of the jobs using the command <code class="docutils literal notranslate"><span class="pre">squeue</span></code>.
The command alone will return a listing of all the jobs running or in queue in the cluster.
To restrict the listing just to jobs submitted by the user with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ squeue -u $USER
                         JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
                        122837   standby       PI gufranco PD       0:00     80 (Resources)
                        122895   standby       PI gufranco PD       0:00     40 (Priority)
</pre></div>
</div>
<p>Notice that we have here two jobs that are in queue.
The status of PD means that the jobs are <strong>pending</strong> of execution.
The ST column gives the state of the job.
In the case above, both jobs are in <strong>pending</strong> state.
The following codes:</p>
<table class="colwidths-given docutils align-default" id="id2">
<caption><span class="caption-text">Job State Codes</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Status</p></th>
<th class="head"><p>Meaning</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>R</p></td>
<td><p>Running</p></td>
<td><p>Job currently has an allocation</p></td>
</tr>
<tr class="row-odd"><td><p>PD</p></td>
<td><p>PenDing</p></td>
<td><p>Job is awaiting resource allocation</p></td>
</tr>
<tr class="row-even"><td><p>TO</p></td>
<td><p>TimedOut</p></td>
<td><p>Job terminated upon reaching its time limit</p></td>
</tr>
<tr class="row-odd"><td><p>PR</p></td>
<td><p>PReempted</p></td>
<td><p>Job terminated due to preemption</p></td>
</tr>
<tr class="row-even"><td><p>S</p></td>
<td><p>Suspended</p></td>
<td><p>Execution has been suspended and CPUs have been released for other jobs</p></td>
</tr>
<tr class="row-odd"><td><p>CD</p></td>
<td><p>CompleteD</p></td>
<td><p>Job has terminated all processes on all nodes with an exit code of zero</p></td>
</tr>
<tr class="row-even"><td><p>CA</p></td>
<td><p>CAncelled</p></td>
<td><p>Job was explicitly cancelled by the user or system administrator</p></td>
</tr>
<tr class="row-odd"><td><p>F</p></td>
<td><p>Failed</p></td>
<td><p>Job terminated with non-zero exit code or other failure condition</p></td>
</tr>
<tr class="row-even"><td><p>NF</p></td>
<td><p>Node Failure</p></td>
<td><p>Job terminated due to failure of one or more allocated nodes</p></td>
</tr>
</tbody>
</table>
<p>There are a few other state conditions that appear less often.
If you see one state that is not one above, check on the manual page for <a class="reference external" href="https://slurm.schedmd.com/squeue.html">squeue</a> under <strong>JOB STATE CODES</strong>.</p>
<p>The columns are for most part self-explanatory.
The final column shows briefly the reasons why the job is still not running.
One of the jobs states that could not run due to a lack of <strong>Resources</strong>, ie there are no 80 compute nodes available at this point.
The other job is pending due to <strong>Priority</strong>, ie there are resources availables but they will be assigned to another job with higher priority.</p>
<p>There are several messages over the Reasons column.
A common set of reasons messages with explanations follows.</p>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">Job Reason Codes</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Reason</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Resources</p></td>
<td><p>Scheduler is unable to find sufficient idle resources to run your job</p></td>
</tr>
<tr class="row-odd"><td><p>Priority</p></td>
<td><p>There are jobs with higher priority ahead of this job in the queue</p></td>
</tr>
<tr class="row-even"><td><p>QOSMaxCpuPerUserLimit</p></td>
<td><p>The CPU request exceeds the maximum each user is allowed to use</p></td>
</tr>
<tr class="row-odd"><td><p>Licenses</p></td>
<td><p>The job is waiting for a license.</p></td>
</tr>
</tbody>
</table>
<p>There are more reason codes that can be found in the <a class="reference external" href="https://slurm.schedmd.com/resource_limits.html#reasons">SLURM documentation for Resource Limits</a></p>
</section>
<section id="canceling-a-job">
<h2>Canceling a job<a class="headerlink" href="#canceling-a-job" title="Permalink to this headline">¶</a></h2>
<p>Lets assume we want to delete the job 122837 that we submitted above.
The job can be canceled with the command <code class="docutils literal notranslate"><span class="pre">scancel</span></code> followed by the jobid of the job you want to cancel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ squeue -u $USER
                         JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
                        122837   standby       PI gufranco PD       0:00     80 (Resources)
trcis001:~$ scancel 122837
trcis001:~$ squeue -u $USER
                         JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
</pre></div>
</div>
<p>As the canceling of a job is an irreversible action it is suggested to use an interactive version that allow you to double check not only the job ID but also the job name and partition in case of mistyping the jobID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ scancel -i 123807
Cancel job_id=123807 name=PI partition=standby [y/n]? y
</pre></div>
</div>
</section>
<section id="estimation-of-the-starting-time-for-a-job">
<h2>Estimation of the starting time for a job<a class="headerlink" href="#estimation-of-the-starting-time-for-a-job" title="Permalink to this headline">¶</a></h2>
<p>SLURM tries to schedule all jobs as quickly as possible, subject to a number of dynamic constrains.
These constrains could be cluster policies, available hardware, allocation priorities (contributers to the cluster get higher priority allocations), etc.
Typically jobs submitted into a <strong>day</strong> queue could start running within a day or so.
Week queues could demand more time as jobs there last longer in execution.
All this can vary a a given point of time on the cluster.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">squeue</span></code>, has some arguments that can show you the scheduler’s estimate of when a pending/idle job will start running.
It is just the scheduler’s best estimate, given current conditions, that on a cluster are permanently changing.
The actual time a job starts might be earlier or later than that depending on factors such as the behavior of currently running jobs, the submission of new jobs, and hardware issues.</p>
<p>To see this, you need to request that squeue show the %S field in the output format option.
One particularly good set of arguments in this situations could be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ squeue -o &quot;%.9i %.9P %.8j %.8u %.2t %.10M %.6D %S&quot; -u $USER
        JOBID PARTITION     NAME     USER ST       TIME  NODES START_TIME
   123809   standby       PI gufranco PD       0:00     40 2023-03-29T22:11:53
   123808   standby       PI gufranco PD       0:00     80 2023-03-30T15:10:06
</pre></div>
</div>
<p>It makes sense that requesting 80 nodes will take more time than requesting 40.
It could happens that some of the jobs running finish before the walltime and the job will enter earlier or could happen than newer jobs enter in partition with higher priority than standby and the job gets delayed.
Use this estimation as a guidance more than a commitment.</p>
</section>
<section id="detailed-information-about-jobs">
<h2>Detailed information about jobs<a class="headerlink" href="#detailed-information-about-jobs" title="Permalink to this headline">¶</a></h2>
<p>The information provided by the command <code class="docutils literal notranslate"><span class="pre">squeue</span></code> sometimes is not enough and you would like to gather a more complete picture of the state of a particular job.
The command <code class="docutils literal notranslate"><span class="pre">scontrol</span></code> provides a wealth of information about jobs but also partitions and nodes.
Information about a job:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ scontrol show job 123809
JobId=123809 JobName=PI
   UserId=gufranco(318130) GroupId=its-rc-thorny(1079001) MCS_label=N/A
   Priority=10675 Nice=0 Account=its-rc-admin QOS=normal
   JobState=PENDING Reason=Resources Dependency=(null)
   Requeue=0 Restarts=0 BatchFlag=1 Reboot=0 ExitCode=0:0
   RunTime=00:00:00 TimeLimit=04:00:00 TimeMin=N/A
   SubmitTime=2023-03-29T19:05:08 EligibleTime=2023-03-29T19:05:08
   AccrueTime=2023-03-29T19:05:08
   StartTime=2023-03-29T22:11:53 EndTime=2023-03-30T02:11:53 Deadline=N/A
   SuspendTime=None SecsPreSuspend=0 LastSchedEval=2023-03-29T19:18:33 Scheduler=Backfill:*
   Partition=standby AllocNode:Sid=trcis001:28116
   ReqNodeList=(null) ExcNodeList=(null)
   NodeList= SchedNodeList=tcscm300,tjscl100,tjscm001,tmmcm[100-108],tngcm200,tpmcm[001-006],tsacs001,tsdcl[001-002],tsscl[001-002],ttmcm[100-101],tzecl[100-107],tzecs[100-105]
   NumNodes=40-40 NumCPUs=800 NumTasks=40 CPUs/Task=20 ReqB:S:C:T=0:0:*:*
   TRES=cpu=800,mem=7717080M,node=40,billing=800
   Socks/Node=* NtasksPerN:B:S:C=0:0:*:* CoreSpec=*
   MinCPUsNode=20 MinMemoryNode=0 MinTmpDiskNode=0
   Features=(null) DelayBoot=00:00:00
   OverSubscribe=OK Contiguous=0 Licenses=(null) Network=(null)
   Command=/gpfs20/users/gufranco/runjob_40n.slurm
   WorkDir=/gpfs20/users/gufranco
   StdErr=/gpfs20/users/gufranco/slurm-123809.out
   StdIn=/dev/null
   StdOut=/gpfs20/users/gufranco/slurm-123809.out
   Power=
</pre></div>
</div>
<p>Information about a parition uses a similar command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ scontrol show partition standby
PartitionName=standby
   AllowGroups=ALL AllowAccounts=ALL AllowQos=ALL
   AllocNodes=ALL Default=YES QoS=N/A
   DefaultTime=NONE DisableRootJobs=NO ExclusiveUser=NO GraceTime=0 Hidden=NO
   MaxNodes=UNLIMITED MaxTime=04:00:00 MinNodes=0 LLN=NO MaxCPUsPerNode=UNLIMITED
   NodeSets=compute
   Nodes=taicm[001-009],tarcl100,tarcs[100,200-206,300-304],tbdcx001,tbmcs[001-011,100-103],
     tbpcm200,tbpcs001,tcbcx100,tcdcx100,tcgcx300,tcocm[100-104],tcocs[001-064,100],
     tcocx[001-003],tcscm300,tjscl100,tjscm001,tmmcm[100-108],tngcm200,tpmcm[001-006],
     tsacs001,tsdcl[001-002],tsscl[001-002],ttmcm[100-101],tzecl[100-107],tzecs[100-115]
   PriorityJobFactor=1 PriorityTier=1 RootOnly=NO ReqResv=NO OverSubscribe=NO
   OverTimeLimit=NONE PreemptMode=CANCEL
   State=UP TotalCPUs=6140 TotalNodes=167 SelectTypeParameters=NONE
   JobDefaults=(null)
   DefMemPerNode=UNLIMITED MaxMemPerNode=UNLIMITED
   TRES=cpu=6140,mem=27963188M,node=167,billing=6140
</pre></div>
</div>
<p>We can also ask for information about a compute node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>trcis001:~$ scontrol show node tbdcx001
NodeName=tbdcx001 Arch=x86_64 CoresPerSocket=20
   CPUAlloc=40 CPUEfctv=40 CPUTot=40 CPULoad=42.22
   AvailableFeatures=xl,compute,bio
   ActiveFeatures=xl,compute,bio
   Gres=(null)
   NodeAddr=tbdcx001 NodeHostName=tbdcx001 Version=22.05.6
   OS=Linux 3.10.0-1160.24.1.el7.x86_64 #1 SMP Thu Mar 25 21:21:56 UTC 2021
   RealMemory=773491 AllocMem=0 FreeMem=646603 Sockets=2 Boards=1
   State=ALLOCATED ThreadsPerCore=1 TmpDisk=0 Weight=1 Owner=N/A MCS_label=N/A
   Partitions=standby
   BootTime=2023-02-23T22:45:08 SlurmdStartTime=2023-02-24T08:35:36
   LastBusyTime=2023-03-29T15:58:11
   CfgTRES=cpu=40,mem=773491M,billing=40
   AllocTRES=cpu=40
   CapWatts=n/a
   CurrentWatts=0 AveWatts=0
   ExtSensorsJoules=n/s ExtSensorsWatts=0 ExtSensorsTemp=n/s
</pre></div>
</div>
</section>
<section id="controling-the-limit-of-time-for-a-job">
<h2>Controling the limit of time for a job<a class="headerlink" href="#controling-the-limit-of-time-for-a-job" title="Permalink to this headline">¶</a></h2>
<p>If no time limit is declared on the submission script or the command line for <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>, a job receives the time limit associated to the partition where it was submitted.
There are ways to declare a time limit and help the scheduler to decide if your job can start running ahead some others with larger time limits.
This is particularly important if your job uses one of the <code class="docutils literal notranslate"><span class="pre">_week</span></code> partitions and you only need 2 or 3 days.
In those cases, the <code class="docutils literal notranslate"><span class="pre">_day</span></code> partitions are not a good fit and you can declare a 3 day time limit and the job could enter in execution faster than other jobs with an entire week of execution.</p>
<blockquote>
<div><p>To specify your estimated runtime, use the –time=TIME or -t TIME parameter to sbatch. This value TIME can in any of the following formats:</p>
</div></blockquote>
<table class="colwidths-given docutils align-default" id="id4">
<caption><span class="caption-text">User Commands</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Format</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>M</p></td>
<td><p>M minutes</p></td>
<td><p>-t 45 (45 minutes)</p></td>
</tr>
<tr class="row-odd"><td><p>M:S</p></td>
<td><p>M minutes, S seconds</p></td>
<td><p>-t 2:30 (Two minutes and 30 seconds)</p></td>
</tr>
<tr class="row-even"><td><p>H:M:S</p></td>
<td><p>H hours, M minutes, S seconds</p></td>
<td><p>-t 1:30:00 (One hour and half)</p></td>
</tr>
<tr class="row-odd"><td><p>D-H</p></td>
<td><p>D days, H hours</p></td>
<td><p>-t 3-12 (3 days and a half)</p></td>
</tr>
<tr class="row-even"><td><p>D-H:M</p></td>
<td><p>D days, H hours, M minutes</p></td>
<td><p>-t 1-12:30 (1 day, 12 hours and 30 minutes)</p></td>
</tr>
<tr class="row-odd"><td><p>D-H:M:S</p></td>
<td><p>D days, H hours, M minutes, S seconds</p></td>
<td><p>-t 6-23:59:59 (One second less than a full week)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="specifying-number-of-nodes-tasks-and-cpu-cores">
<h2>Specifying number of Nodes, tasks and CPU Cores<a class="headerlink" href="#specifying-number-of-nodes-tasks-and-cpu-cores" title="Permalink to this headline">¶</a></h2>
<p>Computationally intesive HPC applications generally use a combination of distributed parallel computing, multithreading or SMP parallelism and accelerators.</p>
<p>The dominant interface for distributed parallel computing is MPI.
MPI uses intependent processes, also called ranks or tasks.
Those processes could potentially run on separate computers and that is the solution programmers implement when the problems are so big than a single computer cannot complete the task alone on a reasonable amount of time.</p>
<p>Multithreading or SMP parallelism uses the multiple CPU cores present in all modern-day computers.
Those cores can all see the entire RAM of the machine.
SMP parallelism is implemented in codes that uses OpenMP, OpenACC.
In high level languages like Python the use of <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module can take advantage of multiple CPU cores on the same machine.
Some Linear Algebra libraries implement SMP parallelism, such as OpenBLAS and Intel MKL.</p>
<p>Sometimes, the access to the certain portion of RAM is faster for one core than the other.
We say that those systems have Non-Uniform Memory Access (NUMA).
For example, a machine with a dual scoket could have a portion of RAM that is associated with each CPU.
In some cases we can gain important speedups by trying to concentrate the memory than a CPU uses into the RAM associated with it.</p>
<p>To better understand how all this can be controlled from SLURM imagine that we have a code that will use a number of CPU cores distributed across several machines.
Consider that N represent the number of MPI tasks, and M represent the number of threads needed by the job.
N MPI tasks can run on N compute nodes but not necessarly.
On the other side if one of those MPI tasks uses multiple CPU cores, all those cores must be on the same machine.
That is a necessary condition for multithreading parallelism.</p>
<p>Most jobs then fall into one of these categories:</p>
<ol class="arabic simple">
<li><p>Sequential/Serial:</p></li>
<li><p>Shared Memory Parallel:</p></li>
<li><p>Distributed Parallelism:</p></li>
<li><p>Hybrid SMP+Distributed Parallelism:</p></li>
<li><p>Accelerator Based Parallelism:</p></li>
</ol>
</section>
<section id="translating-pbs-scripts-to-slurm-scripts">
<h2>Translating PBS Scripts to Slurm Scripts<a class="headerlink" href="#translating-pbs-scripts-to-slurm-scripts" title="Permalink to this headline">¶</a></h2>
<p>All our previous clusters, Mountaineer, Spruce Knob and Thorny Flat used Torque as Resource Manager and Moab as Scheduler. In 2022 we transition to SLURM as workload manager.
For most part the transition is transparent as we installed a set of wrappers that translate on the fly the usual commands from Torque and Moab into the equivalents for SLURM.
The same happens with submission scripts where the lines with <code class="docutils literal notranslate"><span class="pre">#PBS</span></code> get translated into the corresponding <code class="docutils literal notranslate"><span class="pre">$SBATCH</span></code> versions.
That being said is good for our users, specially new users to get used to SLURM commands and directives and stop using as much as possible the Torque commands that could become deprecated at some point in the future or the wrappers not being installed in future HPC clusters.</p>
<p>The following are a set of tables that contains a list of common commands and terms used with the TORQUE/PBS resource manager and scheduler, and the corresponding commands and terms used under the SLURM workload manager.
These tables can be used to assist you in translating existing PBS scripts into proper SLURM scripts that can be interpreted directly.
The same tables can be used for reference when writing new submission scripts directly in SLURM format</p>
<table class="colwidths-given docutils align-default" id="id5">
<caption><span class="caption-text">User Commands</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>User Commands</p></th>
<th class="head"><p>PBS/Torque</p></th>
<th class="head"><p>SLURM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Job submission</p></td>
<td><p>qsub [script_file]</p></td>
<td><p>sbatch [script_file]</p></td>
</tr>
<tr class="row-odd"><td><p>Job deletion</p></td>
<td><p>qdel [job_id]</p></td>
<td><p>scancel [job_id]</p></td>
</tr>
<tr class="row-even"><td><p>Job status (by job)</p></td>
<td><p>qstat [job_id]</p></td>
<td><p>squeue [job_id]</p></td>
</tr>
<tr class="row-odd"><td><p>Job status (by user)</p></td>
<td><p>qstat -u [user_name]</p></td>
<td><p>squeue -u [user_name]</p></td>
</tr>
<tr class="row-even"><td><p>Job hold</p></td>
<td><p>qhold [job_id]</p></td>
<td><p>scontrol hold [job_id]</p></td>
</tr>
<tr class="row-odd"><td><p>Job release</p></td>
<td><p>qrls [job_id]</p></td>
<td><p>scontrol release [job_id]</p></td>
</tr>
<tr class="row-even"><td><p>Queue list</p></td>
<td><p>qstat -Q</p></td>
<td><p>squeue</p></td>
</tr>
<tr class="row-odd"><td><p>Node list</p></td>
<td><p>pbsnodes -l</p></td>
<td><p>sinfo -N OR scontrol show nodes</p></td>
</tr>
<tr class="row-even"><td><p>Cluster status</p></td>
<td><p>qstat -a</p></td>
<td><p>sinfo</p></td>
</tr>
</tbody>
</table>
<table class="colwidths-given docutils align-default" id="id6">
<caption><span class="caption-text">Environment Variables</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Environment</p></th>
<th class="head"><p>PBS/Torque</p></th>
<th class="head"><p>SLURM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Job ID</p></td>
<td><p>$PBS_JOBID</p></td>
<td><p>$SLURM_JOB_ID</p></td>
</tr>
<tr class="row-odd"><td><p>Submit Directory</p></td>
<td><p>$PBS_O_WORKDIR</p></td>
<td><p>$SLURM_SUBMIT_DIR</p></td>
</tr>
<tr class="row-even"><td><p>Submit Host</p></td>
<td><p>$PBS_O_HOST</p></td>
<td><p>$SLURM_SUBMIT_HOST</p></td>
</tr>
<tr class="row-odd"><td><p>Node List</p></td>
<td><p>$PBS_NODEFILE</p></td>
<td><p>$SLURM_JOB_NODELIST</p></td>
</tr>
<tr class="row-even"><td><p>Job Name</p></td>
<td><p>$PBS_JOBNAME</p></td>
<td><p>$SLURM_JOB_NAME</p></td>
</tr>
<tr class="row-odd"><td><p>Number of nodes</p></td>
<td><p>$PBS_NUM_NODES</p></td>
<td><p>$SLURM_JOB_NUM_NODES</p></td>
</tr>
<tr class="row-even"><td><p>Number of cores per node</p></td>
<td><p>$PBS_NUM_PPN</p></td>
<td><p>$SLURM_CPUS_ON_NODE</p></td>
</tr>
<tr class="row-odd"><td><p>Unique index used for Job Arrays</p></td>
<td><p>$PBS_ARRAYID</p></td>
<td><p>$SLURM_ARRAY_TASK_ID</p></td>
</tr>
</tbody>
</table>
<table class="colwidths-given docutils align-default" id="id7">
<caption><span class="caption-text">Job Directives or Specifications</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Job Specification</p></th>
<th class="head"><p>PBS/Torque</p></th>
<th class="head"><p>SLURM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Script directive</p></td>
<td><p>#PBS</p></td>
<td><p>#SBATCH</p></td>
</tr>
<tr class="row-odd"><td><p>Queue/Partition</p></td>
<td><p>-q [name]</p></td>
<td><p>-p [name]</p></td>
</tr>
<tr class="row-even"><td><p>Node Count</p></td>
<td><p>-l nodes=[count]</p></td>
<td><p>-N [min[-max]]</p></td>
</tr>
<tr class="row-odd"><td><p>Total Task Count</p></td>
<td><p>-l ppn=[count]</p></td>
<td><p>-n OR –ntasks=ntasks</p></td>
</tr>
<tr class="row-even"><td><p>Total Task Count</p></td>
<td><p>-l mppwidth=[PE_count]</p></td>
<td><p>-n OR –ntasks=ntasks</p></td>
</tr>
<tr class="row-odd"><td><p>Wall Clock Limit</p></td>
<td><p>-l walltime=[hh:mm:ss]</p></td>
<td><p>-t [min] OR -t [days-hh:mm:ss]</p></td>
</tr>
<tr class="row-even"><td><p>Standard Output File</p></td>
<td><p>-o [file_name]</p></td>
<td><p>-o [file_name]</p></td>
</tr>
<tr class="row-odd"><td><p>Standard Error File</p></td>
<td><p>-e [file_name]</p></td>
<td><p>-e [file_name]</p></td>
</tr>
<tr class="row-even"><td><p>Write stderr -&gt; stdout</p></td>
<td><p>-j oe (both to stdout)</p></td>
<td><p>(use -o without -e)</p></td>
</tr>
<tr class="row-odd"><td><p>Write stdout -&gt; stderr</p></td>
<td><p>-j eo (both to stderr)</p></td>
<td><p>(use -e without -o)</p></td>
</tr>
<tr class="row-even"><td><p>Copy Environment</p></td>
<td><p>-V</p></td>
<td><p>–export=[ALL | NONE | variables]</p></td>
</tr>
<tr class="row-odd"><td><p>Event Notification</p></td>
<td><p>-m abe</p></td>
<td><p>–mail-type=[events]</p></td>
</tr>
<tr class="row-even"><td><p>Email Address</p></td>
<td><p>-M [address]</p></td>
<td><p>–mail-user=[address]</p></td>
</tr>
<tr class="row-odd"><td><p>Job Name</p></td>
<td><p>-N [name]</p></td>
<td><p>–job-name=[name] OR -J [name]</p></td>
</tr>
<tr class="row-even"><td><p>Job Restart</p></td>
<td><p>-r [y | n]</p></td>
<td><p>–requeue OR –no-requeue</p></td>
</tr>
<tr class="row-odd"><td><p>Resource Sharing</p></td>
<td><p>-l naccesspolicy=singlejob</p></td>
<td><p>–exclusive OR –shared</p></td>
</tr>
<tr class="row-even"><td><p>Memory Size</p></td>
<td><p>-l mem=[MB]</p></td>
<td><p>–mem=[mem][M | G | T]</p></td>
</tr>
<tr class="row-odd"><td><p>Memory Size</p></td>
<td><p>-l mem=[MB]</p></td>
<td><p>–mem-per-cpu=[mem][M | G | T]</p></td>
</tr>
<tr class="row-even"><td><p>Accounts to charge</p></td>
<td><p>-A OR -W group_list=[account]</p></td>
<td><p>–account=[account] OR -A</p></td>
</tr>
<tr class="row-odd"><td><p>Tasks Per Node</p></td>
<td><p>-l mppnppn [PEs_per_node]</p></td>
<td><p>–ntasks-per-node=[count]</p></td>
</tr>
<tr class="row-even"><td><p>CPUs Per Task</p></td>
<td><p>N/A</p></td>
<td><p>–cpus-per-task=[count]</p></td>
</tr>
<tr class="row-odd"><td><p>Job Dependency</p></td>
<td><p>-d [job_id]</p></td>
<td><p>–depend=[state:job_id]</p></td>
</tr>
<tr class="row-even"><td><p>Quality of Service</p></td>
<td><p>-l qos=[name]</p></td>
<td><p>–qos=[normal | high]</p></td>
</tr>
<tr class="row-odd"><td><p>Job Arrays</p></td>
<td><p>-t [array_spec]</p></td>
<td><p>–array=[array_spec]</p></td>
</tr>
<tr class="row-even"><td><p>Generic Resources</p></td>
<td><p>-l other=[resource_spec]</p></td>
<td><p>–gres=[resource_spec]</p></td>
</tr>
<tr class="row-odd"><td><p>Job Enqueue Time</p></td>
<td><p>-a “YYYY-MM-DD HH:MM:SS”</p></td>
<td><p>–begin=YYYY-MM-DD[THH:MM[:SS]]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="old-documentation">
<h2>OLD DOCUMENTATION<a class="headerlink" href="#old-documentation" title="Permalink to this headline">¶</a></h2>
<section id="resource-specification">
<h3>Resource Specification<a class="headerlink" href="#resource-specification" title="Permalink to this headline">¶</a></h3>
<p>The #PBS -l option is used to specify resources such as number of CPUs,
nodes, and length of Walltime for the job specified. The three most
common resources specified for the Mountaineer cluster are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>nodes</strong></p></td>
<td><p>Number of nodes needed</p></td>
</tr>
<tr class="row-even"><td><p><strong>walltime</strong></p></td>
<td><p>Maximum limit for walltime given
in the format hh:mm:ss</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ppn</strong></p></td>
<td><p>Processors per node</p></td>
</tr>
<tr class="row-even"><td><p><strong>procs</strong></p></td>
<td><p>Number of processors requested</p></td>
</tr>
<tr class="row-odd"><td><p><strong>pvmem</strong></p></td>
<td><p>Maximum amount of memory used by
any single process in the job</p></td>
</tr>
<tr class="row-even"><td><p><strong>vmem</strong></p></td>
<td><p>Maximum amount of memory used by
all concurrent processes in the
job</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Note: procs is used when you do not require each CPU to be on the same
node.</strong></p>
<p>For example, the PBS directive</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -l nodes=1:ppn=6,walltime=06:00:00</span>
</pre></div>
</div>
<p>Specifies that the job will need 6 processors located on a single node
with a maximum run time of 6 hours. Notice there is no space between
commas or equal signs. Alternatively, if nodes=1 (procs=6 instead) had
not been specified then the scheduler would just grab the first 6
processors available regardless of what nodes they reside on (which will
only work if your program supports distributed computing). In general,
unless you are running jobs using MPI libraries (mpirun) or posix
threads, you will most likely only specify a single processor for your
job (procs=1). <strong>Note:</strong>Resources specifying per node request are
given with the nodes directive and seperated with a :, on the same line
in your script.</p>
<section id="requesting-memory-specifications">
<h4>Requesting Memory Specifications<a class="headerlink" href="#requesting-memory-specifications" title="Permalink to this headline">¶</a></h4>
<p>Requesting memory specifications for jobs is done with the attributes
vmem or pvmem through the PBS -l directive (resource specification). The
man pages of pbs will specify two other memory related attributes: mem
and pmem. However, these two attributes measure different job resources
than virtual memory and therefore are not stable for use the way we
commonly think of memory (use of RAM). In other words, do not use the
attributes mem and pmem - they most likely do not do what you think they
do. vmem and pvmem will put resource limits for the amount of RAM a job
can access. This is important to ensure two large memory jobs do not end
up on the same node; exceeding the node’s memory limits and causing a
node crash (which will kill all jobs on the node). If you do not specify
memory limits - moab will assume a uniform distribution of memory across
all jobs on the node. For example, a 16 processor/64Gb of RAM compute
node will assume roughly 4Gb of RAM per processor. However, if a job
using 62 Gb of RAM and only 8 cores is running on a compute node -
without memory limits Moab will place 8 more processor jobs on that node
when clearly there is not enough memory for any remaining jobs. This
will crash the node. Therefore, we recommend that if you anticipate your
jobs are going to use more than an average of 3Gb per processor that you
specify memory limits for your job using pvmem or vmem. On Spruce
community nodes and Mountaineer we enforce this by making the system
default of pvmem=3gb. On these systems without specifying memory above
3Gb will cause your job to fail. This is important - because on
community nodes if you specify a job with 5 cores and vmem=25Gb; the job
still will fail if it exceeds 15Gb because pvmem=3gb is assigned to each
job by default (i.e. vmem does not override pvmem settings). To make
your PBS scripts portable across community nodes and private nodes, we
recommend that you only use pvmem to specify memory limits of jobs.
pvmem attribute specifies the maximum amount of virtual memory used by
any single processes in the job. Therefore, if you want a job that uses
6 processors and needs 35 Gb of RAM you would specify the following
resource directive line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -l nodes=1:ppn=6,pvmem=6gb</span>
</pre></div>
</div>
<p>pvmem=6gb with 6 processors specifies 6*6 = 36Gb of total memory for the
job.</p>
</section>
<section id="requesting-certain-node-types">
<h4>Requesting Certain Node Types<a class="headerlink" href="#requesting-certain-node-types" title="Permalink to this headline">¶</a></h4>
<p>There might be times where you want to be able to request a node with a
particular feature or processor. The following will allow you to
accomplish this task. Replace ‘feature_name” with one of the features in
the below table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -l feature=feature_name</span>
</pre></div>
</div>
<p>Note, you can also request a particular feature not by doing the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -l feature=&#39;!feature_name&#39;</span>
</pre></div>
</div>
</section>
<section id="available-features">
<h4>Available Features<a class="headerlink" href="#available-features" title="Permalink to this headline">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>smb</p></td>
<td><p>Sandy Bridge Based Processor Nodes</p></td>
</tr>
<tr class="row-odd"><td><p>ivy</p></td>
<td><p>Ivy Bridge Based Processor Nodes</p></td>
</tr>
<tr class="row-even"><td><p>haswell</p></td>
<td><p>Haswell Based Processor Nodes</p></td>
</tr>
<tr class="row-odd"><td><p>broadwell</p></td>
<td><p>Broadwell Based Processor Nodes</p></td>
</tr>
<tr class="row-even"><td><p>avx</p></td>
<td><p>Processors with AVX Extension</p></td>
</tr>
<tr class="row-odd"><td><p>avx2</p></td>
<td><p>Processors with AVX2 Extension</p></td>
</tr>
<tr class="row-even"><td><p>f16c</p></td>
<td><p>Processors with f16c Extension</p></td>
</tr>
<tr class="row-odd"><td><p>adx</p></td>
<td><p>Processors with adx Extension</p></td>
</tr>
<tr class="row-even"><td><p>large</p></td>
<td><p>Nodes with 512 GB of memory</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="e-mail-options">
<h3>E-mail options<a class="headerlink" href="#e-mail-options" title="Permalink to this headline">¶</a></h3>
<p>The #PBS -m and #PBS -M options are used to specify when and to whom the
scheduler will send e-mails. The -m option consists of either the single
character “n”, or one or more of the characters “a”, “b”, and “e”.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>n</strong></p></td>
<td><p>No mail will be sent</p></td>
</tr>
<tr class="row-even"><td><p><strong>a</strong></p></td>
<td><p>Mail is sent when the job is aborted by the batch system</p></td>
</tr>
<tr class="row-odd"><td><p><strong>b</strong></p></td>
<td><p>Mail is sent when the job begins execution</p></td>
</tr>
<tr class="row-even"><td><p><strong>e</strong></p></td>
<td><p>Mail is sent when the job ends</p></td>
</tr>
</tbody>
</table>
<p><strong>Note: If the -m option is not specified, mail will be sent if the job
is aborted.</strong></p>
<p>The shellscript option #PBS -M specifies the e-mail addresses to send
mail to. For example, the PBS directive</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -m ae</span>
<span class="c1">#PBS -M user@mailserver.com</span>
</pre></div>
</div>
<p>The scheduler will send an e-mail to <a class="reference external" href="mailto:user&#37;&#52;&#48;mailserver&#46;com">user<span>&#64;</span>mailserver<span>&#46;</span>com</a> if the job is
aborted, or when the job is completed. To specify more than one e-mail
address with the -M option, each address should be separated with a
comma without any spaces.</p>
<section id="to-receive-no-e-mails-even-on-aborts">
<h4>To Receive no e-mails even on aborts<a class="headerlink" href="#to-receive-no-e-mails-even-on-aborts" title="Permalink to this headline">¶</a></h4>
<p>Even with the ‘n’ option of ‘-m’ directive, the system will still send
an e-mail if the job is cancelled or aborts. To provide the ability for
our users to circumvent this response, we have set-up an alias e-mail
address that can be used to bounce these e-mails. To receive absolutely
no e-mails from the system, no matter what happens before, during and
after execution of your job, use the <a class="reference external" href="mailto:noemail&#37;&#52;&#48;hpc&#46;wvu&#46;edu">noemail<span>&#64;</span>hpc<span>&#46;</span>wvu<span>&#46;</span>edu</a> address with
the ‘n’ option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -m n</span>
<span class="c1">#PBS -m noemail@hpc.wvu.edu</span>
</pre></div>
</div>
</section>
</section>
<section id="output-file-specification">
<h3>Output file specification<a class="headerlink" href="#output-file-specification" title="Permalink to this headline">¶</a></h3>
<p>Default standard output and standard error of the job will be placed in
files named <em>jobname</em>.<strong>o</strong><em>jobid</em> and <em>jobname</em>.<strong>e</strong><em>jobid</em>,
respectfully. These files will be written to the directory in which the
qsub command was executed in. Where jobname is specified using the -N
environment option and jobid is given at run time by the system. The
#PBS -e and #PBS -o options are used to specify what files should be
written for the standard error and standard output stream, respectively.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>-e</strong></p></td>
<td><p>pathname for standard error stream output</p></td>
</tr>
<tr class="row-even"><td><p><strong>-o</strong></p></td>
<td><p>pathname for standard output stream output</p></td>
</tr>
</tbody>
</table>
<p>An example, the PBS directive</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -e /scratch/username/examplejob.error</span>
<span class="c1">#PBS -o /scratch/username/examplejob.output</span>
</pre></div>
</div>
<p>The scheduler will write the files /scratch/username/examplejob.error
and /scratch/username/examplejob.output for the standard error and
standard output streams, respectively.</p>
<p><strong>Note: Use full pathnames for your home directory and scratch
directory</strong></p>
</section>
<section id="requesting-array-jobs">
<h3>Requesting Array jobs<a class="headerlink" href="#requesting-array-jobs" title="Permalink to this headline">¶</a></h3>
<p>By using the directive #PBS -t , you can request a job to be repeated by
a single script a number of times. This is useful if you have data where
you want a single parameter to range over a section of numbers. For
instance, if I wanted a series of commands to be run, with a single
variable in the command to be executed over a range of 10-20 I could use
the following command directives in my shell script</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#PBS -N demographic_${PBS_ARRAYID}
#PBS -l nodes=1:ppn=2
#PBS -t 10-20

mkdir output_${PBS_ARRAYID}/
cd output_${PBS_ARRAYID}/
$SCRATCH/demographic_model.py -input_parameter ${PBS_ARRAYID} -procs 2 -output_file demographic_output.txt
</pre></div>
</div>
<p>The above script would launch ten jobs. Each job would have the name
demographic_; so the first job would be named demographic_10, the
second job would be named demographic_11, and so fourth. Each job would
be run a single node with 2 processors (specified as #PBS -l
nodes=1:ppn=2). Further, each job would make a directory named ouput_
(first job output_10, second job output_11, and so forth). Would cd into
that directory and execute the python script demographic_model.py from
my scratch directory. Notice that one of the input parameters would
change each single job using the PBS set environment variable
PBS_ARRAYID. Array request are very useful in scientific environments
when you need to modify a parameter and see the output for a range of
values. Note: this a theoretical example since I never specified
walltime or a queue to execute this job from.</p>
<p>The number range for array request does not have to be sequential. You
can also list a comma separated list of numbers as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -t 10,15,20,25</span>
</pre></div>
</div>
<p>Further, you can also specify that only a certain number of jobs are
queued at one time in cases where you have a large number of jobs and
need to share a queue with another user</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -t 1-200%10</span>
</pre></div>
</div>
<p>The above directive will only launch ten jobs to the queue at a time
until all 200 job requests have been executed.</p>
</section>
</section>
<section id="interactive-jobs">
<h2>Interactive Jobs<a class="headerlink" href="#interactive-jobs" title="Permalink to this headline">¶</a></h2>
<p>Interactive jobs allow a user to be given an interactive terminal on a
compute node. This allows a user to “interact” directly with a compute
node instead running in a batch or scripted mode. Interactive jobs are
very useful when debugging jobs as it allows a user to walk step-by-step
through your submit script to find errors or problems. Interactive jobs
are also useful when needing to use a graphical program on the cluster.</p>
<p>To run an interactive job use the following command followed by any
necessary PBS variables/flags. If you don’t specify any flags, you will
be given an interactive job in the default queue for the cluster.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qsub</span> <span class="o">-</span><span class="n">I</span>
</pre></div>
</div>
<p>Do note, interactive jobs are only allowed on certain queues. All condo
owner queues are allowed to have interactive jobs as well as queues such
as ‘standby’ and ‘debug’. If you find you need an interactive queue on a
community resource for a particular task or project, please contact
<a class="reference external" href="https://helpdesk.hpc.wvu.edu">Research Computing Help Desk</a> for
assistance.</p>
</section>
<section id="graphical-interface-jobs">
<h2>Graphical Interface Jobs<a class="headerlink" href="#graphical-interface-jobs" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it might be useful or required to run a graphical program on
the cluster. Non-compute intensive processes for visualization purposes
can be run on the login node. These processes include “could” gnuplot, R
and Matlab assuming they have low overhead. However, if you know your
program is consume a lot of resources, it is best to run an <a class="reference external" href="Running_Jobs#Interactive_Jobs">interactive
job</a>.</p>
<p>To execute a graphical application on a compute node, you need to first
review <a class="reference external" href="Using_X_Windows_applications">Using X Windows applications</a>
to properly setup your X (i.e. display) environment. To launch a
graphical job on a compute node, you will need to execute the following
along with any necessary flags/pbs environment variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; qsub -I -X
</pre></div>
</div>
<p>Once you are given an access to a interactive terminal you can run your
the proper executable to launch your graphical (i.e. X Window) program.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module load statistics/matlab
$&gt; matlab &amp;
</pre></div>
</div>
</section>
<section id="checking-the-status-of-jobs">
<h2>Checking the Status of Jobs<a class="headerlink" href="#checking-the-status-of-jobs" title="Permalink to this headline">¶</a></h2>
<p>The status of a job currently submitted to the queue can be checked
using the checkjob command. checkjob displays detailed job state
information and diagnostic output for a specified job. Detailed
information is available for queued, blocked, active, and recently
completed jobs. Users can use checkjob to view the status of their own
jobs.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; checkjob -v &lt;jobid&gt;
</pre></div>
</div>
<p>where is the jobid given at submission time.</p>
<p>The output of checkjob looks like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="mi">1653450</span> <span class="p">(</span><span class="n">RM</span> <span class="n">job</span> <span class="s1">&#39;1653450.srih0001.hpc.wvu.edu&#39;</span><span class="p">)</span>

<span class="n">AName</span><span class="p">:</span> <span class="n">IVY</span>
<span class="n">State</span><span class="p">:</span> <span class="n">Completed</span>
<span class="n">Completion</span> <span class="n">Code</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Time</span><span class="p">:</span> <span class="n">Fri</span> <span class="n">May</span> <span class="mi">19</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">21</span>
<span class="n">Creds</span><span class="p">:</span>  <span class="n">user</span><span class="p">:</span><span class="n">username</span>  <span class="n">group</span><span class="p">:</span><span class="n">groupname</span>  <span class="n">class</span><span class="p">:</span><span class="n">debug</span>  <span class="n">qos</span><span class="p">:</span><span class="n">member</span>
<span class="n">WallTime</span><span class="p">:</span>   <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">16</span> <span class="n">of</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span>
<span class="n">SubmitTime</span><span class="p">:</span> <span class="n">Fri</span> <span class="n">May</span> <span class="mi">19</span> <span class="mi">15</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">58</span>
  <span class="p">(</span><span class="n">Time</span> <span class="n">Queued</span>  <span class="n">Total</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">07</span>  <span class="n">Eligible</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">07</span><span class="p">)</span>

<span class="n">Deadline</span><span class="p">:</span>  <span class="mi">3</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">49</span>  <span class="p">(</span><span class="n">Fri</span> <span class="n">May</span> <span class="mi">19</span> <span class="mi">19</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">58</span><span class="p">)</span>
<span class="n">TemplateSets</span><span class="p">:</span>  <span class="n">DEFAULT</span>
<span class="n">Total</span> <span class="n">Requested</span> <span class="n">Tasks</span><span class="p">:</span> <span class="mi">1</span>

<span class="n">Req</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="n">TaskCount</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">Partition</span><span class="p">:</span> <span class="n">torque</span>
<span class="n">Opsys</span><span class="p">:</span> <span class="o">---</span>  <span class="n">Arch</span><span class="p">:</span> <span class="o">---</span>  <span class="n">Features</span><span class="p">:</span> <span class="n">ivy</span>
<span class="n">GMetric</span><span class="p">[</span><span class="n">energy_used</span><span class="p">]</span>  <span class="n">Current</span><span class="p">:</span> <span class="mf">0.00</span>  <span class="n">Min</span><span class="p">:</span> <span class="mf">0.00</span>  <span class="n">Max</span><span class="p">:</span> <span class="mf">0.00</span>  <span class="n">Avg</span><span class="p">:</span> <span class="mf">0.00</span> <span class="n">Total</span><span class="p">:</span> <span class="mf">0.00</span>
<span class="n">NodeAccess</span><span class="p">:</span> <span class="n">SINGLEJOB</span>
<span class="n">TasksPerNode</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Allocated</span> <span class="n">Nodes</span><span class="p">:</span>
<span class="p">[</span><span class="n">sgpc0001</span><span class="o">.</span><span class="n">hpc</span><span class="o">.</span><span class="n">wvu</span><span class="o">.</span><span class="n">edu</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>


<span class="n">SystemID</span><span class="p">:</span>   <span class="n">Moab</span>
<span class="n">SystemJID</span><span class="p">:</span>  <span class="mi">1653450</span>
<span class="n">Notification</span> <span class="n">Events</span><span class="p">:</span> <span class="n">JobEnd</span><span class="p">,</span><span class="n">JobFail</span>
<span class="n">Task</span> <span class="n">Distribution</span><span class="p">:</span> <span class="n">sgpc0001</span><span class="o">.</span><span class="n">hpc</span><span class="o">.</span><span class="n">wvu</span><span class="o">.</span><span class="n">edu</span>
<span class="n">UMask</span><span class="p">:</span>          <span class="mi">0000</span>
<span class="n">OutputFile</span><span class="p">:</span>     <span class="n">srih0001</span><span class="o">.</span><span class="n">hpc</span><span class="o">.</span><span class="n">wvu</span><span class="o">.</span><span class="n">edu</span><span class="p">:</span><span class="o">/</span><span class="n">gpfs</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">IVY</span><span class="o">.</span><span class="n">o1653450</span>
<span class="n">ErrorFile</span><span class="p">:</span>      <span class="n">srih0001</span><span class="o">.</span><span class="n">hpc</span><span class="o">.</span><span class="n">wvu</span><span class="o">.</span><span class="n">edu</span><span class="p">:</span><span class="o">/</span><span class="n">gpfs</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">IVY</span><span class="o">.</span><span class="n">e1653450</span>
<span class="n">StartCount</span><span class="p">:</span>     <span class="mi">1</span>
<span class="n">Execution</span> <span class="n">Partition</span><span class="p">:</span>  <span class="n">torque</span>
<span class="n">SrcRM</span><span class="p">:</span>          <span class="n">torque</span>  <span class="n">DstRM</span><span class="p">:</span> <span class="n">torque</span>  <span class="n">DstRMJID</span><span class="p">:</span> <span class="mf">1653450.</span><span class="n">srih0001</span><span class="o">.</span><span class="n">hpc</span><span class="o">.</span><span class="n">wvu</span><span class="o">.</span><span class="n">edu</span>
<span class="n">Submit</span> <span class="n">Args</span><span class="p">:</span>    <span class="n">runjob_ivy</span><span class="o">.</span><span class="n">pbs</span>
<span class="n">Flags</span><span class="p">:</span>          <span class="n">RESTARTABLE</span>
<span class="n">Attr</span><span class="p">:</span>           <span class="n">checkpoint</span>
<span class="n">StartPriority</span><span class="p">:</span>  <span class="mi">1000</span>
<span class="n">PE</span><span class="p">:</span>             <span class="mf">1.00</span>
</pre></div>
</div>
<p>Sometimes your job is rejected and you still get a jobid in that case
you can check the reasons with checkjob For example, consider this
submission script where we ask for too much memory for a serial job.</p>
<p>The submisssion script looks like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/sh

#PBS -N TEST
#PBS -l nodes=1:ppn=1,vmem=200g
#PBS -l walltime=00:01:00
#PBS -m ae
#PBS -q groupname
#PBS -n

cd $PBS_O_WORKDIR

date
</pre></div>
</div>
<p>The jobs is accepted by torque but will see the job in queue for a long
time. Now we execute checkjob to know the reasons for not being running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; checkjob -v 1653589

job 1653589 (RM job &#39;1653589.srih0001.hpc.wvu.edu&#39;)

AName: TEST
State: Idle
Creds:  user:username  group:groupname  class:groupname  qos:member
WallTime:   00:00:00 of 00:01:00
BecameEligible: Fri May 19 15:52:14
SubmitTime: Fri May 19 15:51:52
  (Time Queued  Total: 00:01:06  Eligible: 00:00:53)

Deadline:  3:59:54  (Fri May 19 19:52:52)
TemplateSets:  DEFAULT
Total Requested Tasks: 1

Req[0]  TaskCount: 1  Partition: ALL
Memory &gt;= 0  Disk &gt;= 0  Swap &gt;= 3072M
Dedicated Resources Per Task: PROCS: 1  SWAP: 200G
NodeAccess: SINGLEJOB
TasksPerNode: 1
Reserved Nodes:  (3:09:16:24 -&gt; 3:09:17:24  Duration: 00:01:00)
[sarc3001.hpc.wvu.edu:1]


SystemID:   Moab
SystemJID:  1653589
Notification Events: JobEnd,JobFail

UMask:          0000
OutputFile:     srih0001.hpc.wvu.edu:/gpfs/home/username/TEST.o1653589
ErrorFile:      srih0001.hpc.wvu.edu:/gpfs/home/username/TEST.e1653589
Partition List: torque
SrcRM:          torque  DstRM: torque  DstRMJID: 1653589.srih0001.hpc.wvu.edu
Submit Args:    runjob_badmem.pbs
Flags:          RESTARTABLE
Attr:           checkpoint
StartPriority:  2000
PE:             37.34
Reservation &#39;1653589&#39; (3:09:16:24 -&gt; 3:09:17:24  Duration: 00:01:00)
Node Availability for Partition torque --------

srig0001.hpc.wvu.edu     rejected: Swap
szec2001.hpc.wvu.edu     rejected: State (Busy)
szec2002.hpc.wvu.edu     rejected: State (Busy)
szec2003.hpc.wvu.edu     rejected: State (Busy)
...
sbmc0017.hpc.wvu.edu     rejected: State (Busy)
sbmc0018.hpc.wvu.edu     rejected: State (Busy)
sbmg0001.hpc.wvu.edu     rejected: Swap
sric0001.hpc.wvu.edu     rejected: Swap
sric0002.hpc.wvu.edu     rejected: Swap
ssmc0006.hpc.wvu.edu     rejected: Swap
sgsc2001.hpc.wvu.edu     rejected: Class
sgsg2001.hpc.wvu.edu     rejected: Swap
sric0022.hpc.wvu.edu     rejected: Class
sric0025.hpc.wvu.edu     rejected: State (Busy)
sbmc0019.hpc.wvu.edu     rejected: State (Busy)
sbmc0020.hpc.wvu.edu     rejected: Swap
sbmc0021.hpc.wvu.edu     rejected: State (Busy)
sbmc0022.hpc.wvu.edu     rejected: State (Busy)
sric0024.hpc.wvu.edu     rejected: Swap
sllc0001.hpc.wvu.edu     rejected: Swap
...
sspc3006.hpc.wvu.edu     rejected: Swap
sspc3007.hpc.wvu.edu     rejected: Swap
sspc3008.hpc.wvu.edu     rejected: Swap
sspc3009.hpc.wvu.edu     rejected: State (Running)
sspc3010.hpc.wvu.edu     rejected: Swap
NOTE:  job req cannot run in partition torque (available procs do not meet requirements : 0 of 1 procs found)
idle procs: 623  feasible procs:   0

Node Rejection Summary: [Class: 2][State: 110][Swap: 53]
</pre></div>
</div>
<p>The “Swap” reason is “memory” related. The “State” reason is CPU
related. The Queue system search for 623 cores available and could not
find a single machine with 200GB available to launch the job.</p>
<p>Another important tool to monitor jobs and its state is showq</p>
<p>You can get the eligible jobs and their priorities with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">showq</span><span class="o">-</span> <span class="n">i</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ showq -i -u username

eligible jobs----------------------
JOBID                 PRIORITY  XFACTOR  Q  USERNAME    GROUP  PROCS     WCLIMIT     CLASS      SYSTEMQUEUETIME

1579829*                 14108      1.7 me   username groupname     16 14:00:00:00  groupname   Tue May  9 12:09:46
1595467*                 10599      1.6 me   username groupname      4 14:00:00:00  groupname   Thu May 11 22:39:11
1595464*                 10599      1.6 me   username groupname      4 14:00:00:00  groupname   Thu May 11 22:39:11
1595468*                 10599      1.6 me   username groupname      4 14:00:00:00  groupname   Thu May 11 22:39:11
1595466*                 10599      1.6 me   username groupname      4 14:00:00:00  groupname   Thu May 11 22:39:11
1595463*                 10599      1.6 me   username groupname      4 14:00:00:00  groupname   Thu May 11 22:39:10
1595465*                 10599      1.6 me   username groupname      4 14:00:00:00  groupname   Thu May 11 22:39:11
1595462*                 10599      1.6 me   username groupname      4 14:00:00:00  groupname   Thu May 11 22:39:10
1618053*                  6423      1.3 me   username groupname      2 14:00:00:00  groupname   Sun May 14 20:15:33
1618385*                  6363      1.3 me   username groupname      4 14:00:00:00  groupname   Sun May 14 21:14:58
1618386*                  6363      1.3 me   username groupname      4 14:00:00:00  groupname   Sun May 14 21:14:58
1618387*                  6363      1.3 me   username groupname      4 14:00:00:00  groupname   Sun May 14 21:14:59
1618388*                  6363      1.3 me   username groupname      4 14:00:00:00  groupname   Sun May 14 21:14:59
1630355*                  3967      1.2 me   username groupname      4 14:00:00:00  groupname   Tue May 16 13:11:17
1630507*                  3903      1.2 me   username groupname      4 14:00:00:00  groupname   Tue May 16 14:15:09
1630546*                  3884      1.2 me   username groupname     16 14:00:00:00  groupname   Tue May 16 14:34:33
1630494*                     1      1.4 co   username groupname     16  7:00:00:00 comm_larg   Tue May 16 14:08:50
1630349*                     1      1.4 co   username groupname     16  7:00:00:00 comm_larg   Tue May 16 13:10:08

18 eligible jobs

Total jobs:  18
</pre></div>
</div>
<p>Those are jobs that accrue priority as time passes for them on queue.
Some jobs could become blocked, meaning that they are not gaining
priority but will eventually become eligible later in time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ showq -b -u username

blocked jobs-----------------------
JOBID              USERNAME    GROUP      STATE PROCS     WCLIMIT            QUEUETIME

1623738             username groupname       Idle    16  7:00:00:00  Mon May 15 13:49:50
1623747             username groupname       Idle    16  7:00:00:00  Mon May 15 13:51:21
1623757             username groupname       Idle    16  7:00:00:00  Mon May 15 13:52:57
1652487             username groupname       Idle    16     4:00:00  Fri May 19 12:24:44
1646112             username groupname       Idle     4     4:00:00  Thu May 18 15:20:54
1646096             username groupname       Idle     4     4:00:00  Thu May 18 15:17:55
1630495             username groupname       Idle     4  7:00:00:00  Tue May 16 14:10:13
1630501             username groupname       Idle    16  7:00:00:00  Tue May 16 14:11:17
1623766             username groupname       Idle    16  7:00:00:00  Mon May 15 13:55:24
1623746             username groupname       Idle    16  7:00:00:00  Mon May 15 13:50:50
1623749             username groupname       Idle    16  7:00:00:00  Mon May 15 13:51:48
1623751             username groupname       Idle    16  7:00:00:00  Mon May 15 13:52:25
1646143             username groupname       Idle    16  7:00:00:00  Thu May 18 15:26:36
1623759             username groupname       Idle    16  7:00:00:00  Mon May 15 13:53:51
1623758             username groupname       Idle    16  7:00:00:00  Mon May 15 13:53:29
1623760             username groupname       Idle    16  7:00:00:00  Mon May 15 13:54:53
1623740             username groupname       Idle    16  7:00:00:00  Mon May 15 13:50:23
1623731             username groupname       Idle    16  7:00:00:00  Mon May 15 13:49:08
1630569             username groupname       Idle    16  7:00:00:00  Tue May 16 14:48:03
1623739             username groupname       Idle    16  7:00:00:00  Mon May 15 13:49:53
1623732             username groupname       Idle    16  7:00:00:00  Mon May 15 13:49:10

21 blocked jobs

Total jobs:  21
</pre></div>
</div>
<p>Finally, you can see the jobs that are currently running with their
remaining time until hit their wall time</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ showq -r -u username

active jobs------------------------
JOBID               S  PAR  EFFIC  XFACTOR  Q  USERNAME    GROUP            MHOST PROCS   REMAINING            STARTTIME

1599005             R  tor  24.99      1.0 co   username groupname sric0011.hpc.wvu    16    00:24:38  Fri May 12 17:01:10
1599006             R  tor  24.99      1.0 co   username groupname sric0020.hpc.wvu    16    00:51:08  Fri May 12 17:27:40
1599007             R  tor  24.98      1.0 co   username groupname sric0021.hpc.wvu    16     1:03:41  Fri May 12 17:40:13
1599008             R  tor  24.99      1.0 co   username groupname sric0023.hpc.wvu    16     1:04:45  Fri May 12 17:41:17
1599009             R  tor  24.99      1.1 co   username groupname sric0032.hpc.wvu    16     4:42:25  Fri May 12 21:18:57
1599010             R  tor  24.99      1.1 co   username groupname sric0026.hpc.wvu    16     4:42:25  Fri May 12 21:18:57
1599011             R  tor  24.99      1.1 co   username groupname sric0017.hpc.wvu    16    10:10:42  Sat May 13 02:47:14
1546851             R  tor  99.73      2.6 co   username groupname sric0025.hpc.wvu    16  2:13:45:30  Mon May 15 06:22:02
1570354             R  tor  87.78      1.0 me   username groupname sarc3001.hpc.wvu    16  3:08:32:50  Tue May  9 01:09:22
1595446             R  tor  98.27      1.0 me   username groupname sarc2001.hpc.wvu     4  6:06:02:54  Thu May 11 22:39:26
1595448             R  tor  99.98      1.0 me   username groupname sarc2001.hpc.wvu     4  6:07:29:35  Fri May 12 00:06:07
1595449             R  tor  99.99      1.0 me   username groupname sarc0001.hpc.wvu     4  6:08:21:37  Fri May 12 00:58:09
1595453             R  tor  99.99      1.0 me   username groupname sarc0002.hpc.wvu     4  6:08:49:41  Fri May 12 01:26:13
1618813             R  tor  24.77      1.7 co   username groupname sric0037.hpc.wvu    16  6:20:47:59  Fri May 19 13:24:31
1618812             R  tor  24.77      1.7 co   username groupname sric0051.hpc.wvu    16  6:20:47:59  Fri May 19 13:24:31
1618814             R  tor  24.78      1.7 co   username groupname sric0036.hpc.wvu    16  6:20:47:59  Fri May 19 13:24:31
1618815             R  tor  24.84      1.7 co   username groupname sric0030.hpc.wvu    16  6:20:54:14  Fri May 19 13:30:46
1595460             R  tor  99.97      1.1 me   username groupname sarc0006.hpc.wvu     4  8:06:16:50  Sat May 13 22:53:22
1595461             R  tor  99.97      1.2 me   username groupname sarc0009.hpc.wvu     4  8:13:36:38  Sun May 14 06:13:10

19 active jobs         232 of 3112 processors in use by local jobs (7.46%)
                        155 of 165 nodes active      (93.94%)

Total jobs:  19
</pre></div>
</div>
</section>
<section id="canceling-removing-a-job">
<h2>Canceling/Removing a Job<a class="headerlink" href="#canceling-removing-a-job" title="Permalink to this headline">¶</a></h2>
<p>Jobs can be cancelled or removed using the canceljob command. Users can
only remove jobs they submitted to the scheduler.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  $&gt; canceljob &lt;jobid&gt;

is the jobid given at submission time.
</pre></div>
</div>
<p>Now canceljob is deprecated and Moab offers and alternative to cancel
jobs For example, if you want to cancel jobs that starts with 1693 you
can use this command to cancel those jobs. As user you can only cancel
jobs that you own so do not worry about canceling jobs from other users
by doing this.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; mjobctl -c &quot;x:1693.*&quot;
</pre></div>
</div>
</section>
<section id="adding-prologue-and-epilogue-scripts-to-a-job">
<h2>Adding Prologue and Epilogue scripts to a Job<a class="headerlink" href="#adding-prologue-and-epilogue-scripts-to-a-job" title="Permalink to this headline">¶</a></h2>
<p>It is possible to declare scripts that run before and after the
execution of the main submission script. The main advantage of those is
to keep a record of the conditions under which a given job is running.
Here we present a simple example of how to declare an prologue and
epilogue.</p>
<p>Add these lines to your submission script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -l prologue=/absolute/path/to/prologue.sh</span>
<span class="c1">#PBS -l epilogue=/absolute/path/to/epilogue.sh</span>
</pre></div>
</div>
<p>The best way of working with those scripts is adding them to your home
folder and use them on all your submission scripts. They should collect
information that you can use later for debugging or profiling purposes.</p>
<section id="example-of-prologue">
<h3>Example of Prologue<a class="headerlink" href="#example-of-prologue" title="Permalink to this headline">¶</a></h3>
<p>prologue.sh</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="n">echo</span> <span class="s2">&quot;&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Prologue Args:&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Job ID: $1&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;User ID: $2&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Group ID: $3&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span>

<span class="n">env</span> <span class="o">|</span> <span class="n">sort</span>
<span class="n">hostname</span>
<span class="n">date</span>

<span class="n">exit</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="example-of-epilogue">
<h3>Example of Epilogue<a class="headerlink" href="#example-of-epilogue" title="Permalink to this headline">¶</a></h3>
<p>epilogue.sh</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="n">echo</span> <span class="s2">&quot;&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Epilogue Args:&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Job ID: $1&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;User ID: $2&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Group ID: $3&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Job Name: $4&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Session ID: $5&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Resource List: $6&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Resources Used: $7&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Queue Name: $8&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Account String: $9&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span>

<span class="n">env</span> <span class="o">|</span> <span class="n">sort</span>
<span class="n">hostname</span>
<span class="n">date</span>

<span class="n">exit</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Both prologue and epilogue must be made executable, use “</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">prologue</span><span class="o">.</span><span class="n">sh</span> <span class="n">epilogue</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>to change their permissions.</p>
</section>
</section>
<section id="samples-of-job-submission-scripts">
<h2>Samples of Job Submission scripts<a class="headerlink" href="#samples-of-job-submission-scripts" title="Permalink to this headline">¶</a></h2>
<p>Below are bash scripts that can be modified and submitted to the qsub
command for job submission. For details about the different parts of the
scripts please visit the <a class="reference external" href="RunningJobs">Running Jobs</a> page. These
scripts can be copied and pasted in the terminal using any number of
text editors (i.e. vi, emacs, etc…)</p>
</section>
<section id="script-for-running-a-non-array-batch-queue">
<h2>Script for running a non-array batch queue<a class="headerlink" href="#script-for-running-a-non-array-batch-queue" title="Permalink to this headline">¶</a></h2>
<p>The below script has PBS directives to set-up commonly used variables
such as job name, resources needed, e-mail address upon job completion
and abnormal termination and specify a queue to run on</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="c1">#This is an example script for executing generic jobs with</span>
<span class="c1"># the use of the command &#39;qsub &lt;name of this script&gt;&#39;</span>


<span class="c1">#These commands set up the Grid Environment for your job.  Words surrounding by a backet (&#39;&lt;&#39;,&#39;&gt;&#39;) should be changed</span>
<span class="c1">#Any of the PBS directives can be commented out by placing another pound sign in front</span>
<span class="c1">#example</span>
<span class="c1">##PBS -N name</span>
<span class="c1">#The above line will be skipped by qsub because of the two consecutive # signs</span>

<span class="c1"># Specify job name</span>
<span class="c1">#PBS -N &lt;name&gt;</span>

<span class="c1"># Specify the resources need for the job</span>
<span class="c1"># Walltime is specified as hh:mm:ss (hours:minutes:seconds)</span>
<span class="c1">#PBS -l nodes=&lt;number_of_nodes&gt;:ppn=&lt;number_of_processors_per_node,walltime=&lt;time_needed_by_job&gt;</span>


<span class="c1"># Specify when Moab should send e-mails &#39;ae&#39; below user will</span>
<span class="c1"># receive e-mail for any errors with the job and/or upon completion</span>
<span class="c1"># If you don&#39;t want e-mails just comment out these next two PBS lines</span>
<span class="c1">#PBS -m ae</span>

<span class="c1"># Specify the e-mail address to receive above mentioned e-mails</span>
<span class="c1">#PBS -M &lt;email_address&gt;</span>

<span class="c1"># Specify the queue to execute task in. Current options can be found by excuting the command qstat -q at the terminal</span>
<span class="c1">#PBS -q &lt;queue_name&gt;</span>

<span class="c1"># Enter your command below with arguments just as if you where going to execute on the command line</span>
<span class="c1"># It is generally good practice to issue a &#39;cd&#39; command into the directory that contains the files</span>
<span class="c1"># you want to use or use full path names</span>
</pre></div>
</div>
</section>
<section id="script-for-running-an-array-batch-queue">
<h2>Script for running an array batch queue<a class="headerlink" href="#script-for-running-an-array-batch-queue" title="Permalink to this headline">¶</a></h2>
<p>Script is the same as above, but adds PBS -t to execute array request
job submissions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="c1">#This is an example script for executing genetic jobs with</span>
<span class="c1"># the use of the command &#39;qsub &lt;name of this script&gt;&#39;</span>


<span class="c1">#These commands set up the Grid Environment for your job.  Words surrounding by a backet (&#39;&lt;&#39;,&#39;&gt;&#39;) should be changed</span>
<span class="c1">#Any of the PBS directives can be commented out by placing another pound sign in front</span>
<span class="c1">#example</span>
<span class="c1">##PBS -N name</span>
<span class="c1">#The above line will be skipped by qsub because of the two consecutive # signs</span>

<span class="c1"># Specify job name, use ${PBS_ARRAYID} to ensure names and output/error files have different names</span>
<span class="c1">#PBS -N &lt;name_${PBS_ARRAYID}</span>

<span class="c1"># Specify the range for the PBS_ARRAYID environment variable</span>
<span class="c1"># &lt;num_range&gt; can be a continous range like 1-200 or 5-20</span>
<span class="c1"># or &lt;num_range&gt; can be a comma seperated list of numbers like 5,15,20,55</span>
<span class="c1"># You can also specify the maximum number of jobs queued at one time with the percent sign</span>
<span class="c1"># so a &lt;num_range&gt; specified as 5-45%8 would launch forty jobs with a range from 5-45, but only queue 8 at a time until</span>
<span class="c1"># all jobs are completed.</span>
<span class="c1"># Further, you can mix and match continous range and list like 1-10,15,25-40%10</span>
<span class="c1">#PBS -t &lt;num_range&gt;</span>

<span class="c1"># Specify the resources need for the job</span>
<span class="c1"># Walltime is specified as hh:mm:ss (hours:minutes:seconds)</span>
<span class="c1">#PBS -l nodes=&lt;number_of_nodes&gt;:ppn=&lt;number_of_processors_per_node,walltime=&lt;time_needed_by_job&gt;</span>


<span class="c1"># Specify when Moab should send e-mails &#39;ae&#39; below user will</span>
<span class="c1"># receive e-mail for any errors with the job and/or upon completion</span>
<span class="c1"># If you don&#39;t want e-mails just comment out these next two PBS lines</span>
<span class="c1">#PBS -m ae</span>

<span class="c1"># Specify the e-mail address to receive above mentioned e-mails</span>
<span class="c1">#PBS -M &lt;email_address&gt;</span>

<span class="c1"># Specify the queue to execute task in. Current options can be found by excuting the command qstat -q at the terminal</span>
<span class="c1">#PBS -q &lt;queue_name&gt;</span>

<span class="c1"># Enter your command below with arguments just as if you where going to execute on the command line</span>
<span class="c1"># It is generally good practice to issue a &#39;cd&#39; command into the directory that contains the files</span>
<span class="c1"># you want to use or use full path names</span>
<span class="c1"># Any parameter or filename that needs to use the current job number of the array number range use ${PBS_ARRAYID}</span>
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="35.TransferFiles.html" class="btn btn-neutral float-right" title="File Transfer (Globus and SFTP)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="33.EnvModules.html" class="btn btn-neutral float-left" title="Environment Modules" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, West Virginia University

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>