Updating NVIDIA Driver and CUDA Toolkit
---------------------------------------

Steps to install new NVIDIA Driver and CUDA Toolkit
This procedure must be executed as root on a machine that is not running jobs.
The compute node must be drained in advance on SLURM

On SLURM, the command ``scontrol`` can modify the state of the machine by specifying the node and the new state. 
You must provide a reason when disabling a node.

 * **Disable**::

    scontrol update NodeName=tcogq[001-006] State=DRAIN Reason="CUDA UPDATE"

 * **Enable**::

    scontrol update NodeName=tcogq[001-006] State=RESUME

Connect via SSH to the compute node and execute these steps:

1. Stop daemon that uses nvidia kernel module
::

	$> systemctl stop nvidia-dcgm

2. Remove all modules depending on ``nvidia``
::

    $> rmmod nvidia_drm nvidia_modeset nvidia_uvm nvidia

3. Install NVIDIA Driver and CUDA Toolkit
::

	$> sh /shared/src/cuda_12.2.1_535.86.10_linux.run --silent --driver
	$> sh /shared/src/cuda_12.2.1_535.86.10_linux.run --silent --toolkit

4. Restart the machine
::

    $> reboot

